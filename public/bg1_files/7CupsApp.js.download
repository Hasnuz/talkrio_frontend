function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var a,n=Object.keys(t);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(t),e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,a)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(a),!0).forEach(function(e){_defineProperty(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function _defineProperty(e,t,a){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0===a)return("string"===t?String:Number)(e);a=a.call(e,t||"default");if("object"!=_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}function _regeneratorRuntime(){_regeneratorRuntime=function(){return i};var c,i={},e=Object.prototype,l=e.hasOwnProperty,u=Object.defineProperty||function(e,t,a){e[t]=a.value},t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",a=t.asyncIterator||"@@asyncIterator",s=t.toStringTag||"@@toStringTag";function o(e,t,a){return Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(c){o=function(e,t,a){return e[t]=a}}function r(e,t,a,n){var s,o,i,r,t=t&&t.prototype instanceof C?t:C,t=Object.create(t.prototype),n=new S(n||[]);return u(t,"_invoke",{value:(s=e,o=a,i=n,r=d,function(e,t){if(r===f)throw Error("Generator is already running");if(r===m){if("throw"===e)throw t;return{value:c,done:!0}}for(i.method=e,i.arg=t;;){var a=i.delegate;if(a){a=function e(t,a){var n=a.method,s=t.iterator[n];if(s===c)return a.delegate=null,"throw"===n&&t.iterator.return&&(a.method="return",a.arg=c,e(t,a),"throw"===a.method)||"return"!==n&&(a.method="throw",a.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;n=h(s,t.iterator,a.arg);if("throw"===n.type)return a.method="throw",a.arg=n.arg,a.delegate=null,g;s=n.arg;return s?s.done?(a[t.resultName]=s.value,a.next=t.nextLoc,"return"!==a.method&&(a.method="next",a.arg=c),a.delegate=null,g):s:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,g)}(a,i);if(a){if(a===g)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===d)throw r=m,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=f;a=h(s,o,i);if("normal"===a.type){if(r=i.done?m:p,a.arg===g)continue;return{value:a.arg,done:i.done}}"throw"===a.type&&(r=m,i.method="throw",i.arg=a.arg)}})}),t}function h(e,t,a){try{return{type:"normal",arg:e.call(t,a)}}catch(e){return{type:"throw",arg:e}}}i.wrap=r;var d="suspendedStart",p="suspendedYield",f="executing",m="completed",g={};function C(){}function v(){}function y(){}var t={},b=(o(t,n,function(){return this}),Object.getPrototypeOf),b=b&&b(b($([]))),w=(b&&b!==e&&l.call(b,n)&&(t=b),y.prototype=C.prototype=Object.create(t));function k(e){["next","throw","return"].forEach(function(t){o(e,t,function(e){return this._invoke(t,e)})})}function I(i,r){var t;u(this,"_invoke",{value:function(a,n){function e(){return new r(function(e,t){!function t(e,a,n,s){var o,e=h(i[e],i,a);if("throw"!==e.type)return(a=(o=e.arg).value)&&"object"==_typeof(a)&&l.call(a,"__await")?r.resolve(a.__await).then(function(e){t("next",e,n,s)},function(e){t("throw",e,n,s)}):r.resolve(a).then(function(e){o.value=e,n(o)},function(e){return t("throw",e,n,s)});s(e.arg)}(a,n,e,t)})}return t=t?t.then(e,e):e()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function $(t){if(t||""===t){var a,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return a=-1,(e=function e(){for(;++a<t.length;)if(l.call(t,a))return e.value=t[a],e.done=!1,e;return e.value=c,e.done=!0,e}).next=e}throw new TypeError(_typeof(t)+" is not iterable")}return u(w,"constructor",{value:v.prototype=y,configurable:!0}),u(y,"constructor",{value:v,configurable:!0}),v.displayName=o(y,s,"GeneratorFunction"),i.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},i.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,o(e,s,"GeneratorFunction")),e.prototype=Object.create(w),e},i.awrap=function(e){return{__await:e}},k(I.prototype),o(I.prototype,a,function(){return this}),i.AsyncIterator=I,i.async=function(e,t,a,n,s){void 0===s&&(s=Promise);var o=new I(r(e,t,a,n),s);return i.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},k(w),o(w,s,"Generator"),o(w,n,function(){return this}),o(w,"toString",function(){return"[object Generator]"}),i.keys=function(e){var t,a=Object(e),n=[];for(t in a)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in a)return e.value=t,e.done=!1,e}return e.done=!0,e}},i.values=$,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&l.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=c)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(a){if(this.done)throw a;var n=this;function e(e,t){return o.type="throw",o.arg=a,n.next=e,t&&(n.method="next",n.arg=c),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var s=this.tryEntries[t],o=s.completion;if("root"===s.tryLoc)return e("end");if(s.tryLoc<=this.prev){var i=l.call(s,"catchLoc"),r=l.call(s,"finallyLoc");if(i&&r){if(this.prev<s.catchLoc)return e(s.catchLoc,!0);if(this.prev<s.finallyLoc)return e(s.finallyLoc)}else if(i){if(this.prev<s.catchLoc)return e(s.catchLoc,!0)}else{if(!r)throw Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return e(s.finallyLoc)}}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;0<=a;--a){var n=this.tryEntries[a];if(n.tryLoc<=this.prev&&l.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}var o=(s=s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc?null:s)?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var a=this.tryEntries[t];if(a.finallyLoc===e)return this.complete(a.completion,a.afterLoc),T(a),g}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var a,n,s=this.tryEntries[t];if(s.tryLoc===e)return"throw"===(a=s.completion).type&&(n=a.arg,T(s)),n}throw Error("illegal catch attempt")},delegateYield:function(e,t,a){return this.delegate={iterator:$(e),resultName:t,nextLoc:a},"next"===this.method&&(this.arg=c),g}},i}function asyncGeneratorStep(e,t,a,n,s,o,i){try{var r=e[o](i),c=r.value}catch(e){return void a(e)}r.done?t(c):Promise.resolve(c).then(n,s)}function _asyncToGenerator(r){return function(){var e=this,i=arguments;return new Promise(function(t,a){var n=r.apply(e,i);function s(e){asyncGeneratorStep(n,t,a,s,o,"next",e)}function o(e){asyncGeneratorStep(n,t,a,s,o,"throw",e)}s(void 0)})}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(t,e){var a,n=Object.keys(t);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(t),e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,a)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(a),!0).forEach(function(e){_defineProperty(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperty(e,t,a){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0===a)return("string"===t?String:Number)(e);a=a.call(e,t||"default");if("object"!=_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}$(function(){$("body").on("click",'[data-method="ajax"] button[type="submit"]',function(e){e.preventDefault();var l=$(this),u=l.closest('form[data-method="ajax"]'),t={url:u.attr("action"),type:u.attr("method")||"post",cache:!1,dataType:u.attr("data-request-datatype")||"json",contentType:!1,success:function(e){if("number"==typeof e.status&&(1===e.status?(e.data&&e.data.success&&(e.success=e.data.success),e.data&&e.data.message&&(e.alert=e.alert||{},e.alert.success=e.alert.success||[],e.alert.success.push(e.data.message))):"string"==typeof e.error&&(e.error={alert:[e.error+(e.details&&e.details.message?" - "+e.details.message:"")]})),e.error){if(e.error.input)for(var t in e.error.input)u.find('[name="'+t+'"]').addClass("is-invalid"),e.error.input[t].length&&(u.find('[name="'+t+'"]').attr("aria-describedby","error_"+t),u.find('[name="'+t+'"]').after('<div class="invalid-feedback small" id="error_'+t+'">'+e.error.input[t]+"</div>"),r=u.find(".is-invalid"));if(e.error.alert)for(var a=0;a<e.error.alert.length;a++)e.alert=e.alert||{},e.alert.danger=e.alert.danger||[],e.alert.danger.push(e.error.alert[a])}if(e.alert)for(var n in e.alert)for(var s=0;s<e.alert[n].length;s++){var o=0==s?"error":"error_"+s,i=$("input",u).first(),r=(i.first().attr("aria-describedby",o),u.prepend('<div class="alert alert-resp alert-'+n+'" id="'+o+'">'+e.alert[n][s]+"</div>"),u.find(".alert-resp"));i.trigger("focus")}var c;r&&$("body, html").animate({scrollTop:r.offset().top-75},"slow"),e.success?(e.success.url?setTimeout(function(){window.location.href=e.success.url},e.success.delay||0):(l.html(function(){return $(this).attr("data-temp-html")}),u.find('button[type="submit"]').removeAttr("disabled")),e.success.text&&(c="<strong>"+e.success.text+"</strong>",u.closest(".modal").length&&(c+='<button data-bs-dismiss="modal" class="btn btn-primary mt-4 m-t-md">Close</button>'),u.replaceWith('<div class="text-center alert alert-resp alert-success">'+c+"</div>"))):(l.html(function(){return $(this).attr("data-temp-html")}),u.find('button[type="submit"]').removeAttr("disabled"),"undefined"!=typeof grecaptcha&&$(".g-recaptcha").length&&grecaptcha.reset()),u.attr("data-callback")&&"function"==typeof(c=window[u.attr("data-callback")])&&c(u,e),u.trigger("ajaxresponse",[e])}};if("post"===t.type)t.data=new FormData(u[0]),t.data.append("data-request-datatype",t.dataType),t.data.append("submit-value",l.val()||null),u.find('input[type="file"]').each(function(){""==$(this).val()&&void 0!==t.data.delete&&t.data.delete($(this).attr("name"))}),t.processData=!1;else{t.data={};for(var a=u.serializeArray(),n=0;n<a.length;n++)t.data[a[n].name]=a[n].value;t.data["data-request-datatype"]=t.dataType,t.data["submit-value"]=l.val()||null,"put"===t.type&&(t.headers={"Content-Type":"application/x-www-form-urlencoded"})}l.attr("data-temp-html",function(){return $(this).html()}).html('<i class="fa-solid fa-spinner fa-spin"></i> Processing'),u.find('button[type="submit"]').attr("disabled","true"),u.find(".is-invalid").removeClass("is-invalid"),u.find(".alert-resp, .invalid-feedback").remove(),$.ajax(t)})}),$(function(){$("body").on("submit",'[data-method="apiv2"]',function(e){e.preventDefault();var o=$(this),s=o.find('[type="submit"]');function t(){var e,n,t,a={},a=(a=o.find('[type="file"]').length?{data:(e=o,n=new FormData,t=e.serializeArray(),$.each(e.find('input[type="file"]'),function(e,a){$.each($(a)[0].files,function(e,t){n.append(a.name,t)})}),$.each(t,function(e,t){n.append(t.name,t.value)}),n),processData:!1,contentType:!1}:{data:(e=o.serializeArray(),s.attr("name")&&s.attr("name").length&&s.val().length&&e.push({name:s.attr("name"),value:s.val()}),e)},Object.assign(a,{url:o.attr("action"),type:o.attr("method").toUpperCase(),cache:!1,dataType:"json",error:function(e,t,a){var n=e.responseJSON||{};n.errors||(n.errors=[{message:"API Error: "+a,code:e.status}]),i(n,t,e),r()},success:function(e,t,a){i(e,t,a)}}));$.ajax(a)}function i(e,t,a){if(e.errors){for(var n=0;n<e.errors.length;n++){var s=e.errors[n];s.param?(o.find('[name="'+s.param+'"]').addClass("is-invalid"),s.message&&s.code&&400!=s.code&&(o.find('[name="'+s.param+'"]').attr("aria-describedby","error_"+s.param),o.find('[name="'+s.param+'"]').after('<div class="invalid-feedback small" id="error_'+s.param+'">'+s.message+"</div>"))):o.prepend('<div class="alert alert-resp alert-danger">'+(s.message||"Error: Error details not found.")+"</div>")}o.find(".is-invalid").length&&o.find(".is-invalid").first().trigger("focus"),o.trigger("apiError",[e,t,a]),r()}else o.trigger("apiSuccess",[e,t,a])}function r(){s.removeAttr("disabled").find(".fa-spinner").remove(),"undefined"!=typeof grecaptcha&&$(".g-recaptcha").length&&grecaptcha.reset(),o.find('[name="stripeToken"]').remove(),$("body, html").animate({scrollTop:o.offset().top},"slow")}s.prepend('<i class="fa-solid fa-spinner fa-spin me-1"></i>').attr("disabled","true"),o.find(".alert-resp, .invalid-feedback").remove(),o.find(".is-invalid").removeClass("is-invalid"),o[0].stripe&&0!=o[0].stripe.cardrequired?o[0].stripe.interface.createToken(o[0].stripe.card).then(function(e){e.error?i({errors:[e.error]},null,null):(o.append('<input type="hidden" name="stripeToken" value="'+e.token.id+'">'),t())}):t()})}),$(function(){$(document).on("click",".video-transcript-viewer",function(e){var e=e.currentTarget.getAttribute("href"),t=$('<div id="content"><i class="fa-solid fa-spin fa-spinner"></i> '+_("Loading Transcript")+"</div>");return $.ajax({url:e,method:"GET",dataType:"json",beforeSend:function(){bootbox.dialog({title:"Transcript of video",size:"large",message:t,onEscape:!0,backdrop:!0,closeButton:!0})},success:function(e){render(!1,"Video_Transcript",{translations:e.text},function(e){t.html(e)})},statusCode:{400:function(e){t.html("Transcript not available!"),console.dir(e)}}}),!1});function e(e){e.stopPropagation(),e.preventDefault();var t=(e=$(this)).attr("src"),a=(e.closest("a").trigger("blur"),e.attr("data-src-animated")),n=e.attr("data-src-static");void 0!==a?(e.attr("data-src-static",t),e.attr("src",a),e.removeAttr("data-src-animated")):void 0!==n&&(e.attr("data-src-animated",t),e.attr("src",n),e.removeAttr("data-src-static")),0==(a=e.parent(".frozen-gif-wrapper")).length?(e.wrap('<div class="frozen-gif-wrapper"></div>'),e.after('<div class="frozen-gif-overlay"></div>')):($(".frozen-gif-overlay",a).remove(),e.unwrap(".frozen-gif-wrapper"))}$("body").on("click","[data-src-static]",e),$("body").on("click","[data-src-animated]",e),$("body").on("click",".frozen-gif-overlay",function(e){var t=$(this);e.stopPropagation(),e.preventDefault(),t.closest("a").trigger("blur"),t.parent(".frozen-gif-wrapper").find("img").trigger("click")})}),$(function(){$("body").on("click",'[data-bs-toggle="collapse"]',function(){$($(this).attr("data-bs-target")||$(this).attr("href")).addClass("collapse-userstate")}),$("body").on("click","[data-toggle=collapse-sameparent]",function(){var e=$(this).closest(".collapse-parent");(e=e.length?e:$(this).parent()).find(".collapse").collapse("toggle")}),$("body").on("click","[data-toggle=collapse-partial][data-target]",function(){$($(this).attr("data-target")).toggleClass("show")}),$("body").on("click","[data-bs-toggle=collapse], [data-toggle=collapse-partial], [data-toggle=collapse-sameparent]",function(){var e=$(this);e.find(".collapse-toggle-text").each(function(){var t=$(this),a=t.text();[["+","-"],["-","+"],[_("More"),_("Less")],[_("more"),_("less")],[_("all"),_("less")],[_("Less"),_("More")],[_("less"),_("more")]].forEach(function(e){a.includes(e[0])&&t.text(function(){return t.text().replace(e[0],e[1])})})}),e.find(".collapse-toggle-indicator").each(function(){($(this).is(".fa-caret-down")||$(this).is(".fa-caret-up"))&&$(this).toggleClass("fa-caret-down fa-caret-up"),($(this).is(".fa-angle-down")||$(this).is(".fa-angle-up"))&&$(this).toggleClass("fa-angle-down fa-angle-up"),($(this).is(".fa-arrow-down")||$(this).is(".fa-arrow-up"))&&$(this).toggleClass("fa-arrow-down fa-arrow-up"),($(this).is(".fa-circle-plus")||$(this).is(".fa-circle-minus"))&&$(this).toggleClass("fa-circle-plus fa-circle-minus")})}),$("body").on("shown.bs.tab",'[data-bs-toggle="tab"]',function(){collapsePartialInit()}),collapsePartialInit()}),window.collapsePartialInit=function(){$("[data-toggle=collapse-partial][data-target]").each(function(){var e=$(this),t=$(e.attr("data-target"));e.toggle(parseInt(t.outerHeight()+2)>=parseInt(t.css("max-height")))})},$(function(){var t=["xs","sm","md","lg","xl","xxl"];$(window).on("scroll resize",function(){0<$(window).scrollTop()?$("body").addClass("body-scrolling"):$("body").removeClass("body-scrolling")}),$(window).on("scroll resize",function(){$("[class *= 'position-sticky-']").css("top",function(e,t){var a=$("#main-page-content").offset().top,n=~~Math.max(0,$(this).outerHeight()+a-$(window).innerHeight()+50);return"sticky"===$(this).css("position")&&n<$(window).scrollTop()?a-n:""})}),$(window).on("scroll resize",function(){var e=($("body").css("--bs-breakpoint")||"").trim(),a=t.indexOf(e);0<=a&&t.forEach(function(e,t){t<=a&&0<$(window).scrollTop()?$(".scrolling-d-"+e+"-none").slideUp():$(".scrolling-d-"+e+"-none").slideDown()})})}),$(function(){$(document).on("show.bs.modal",".modal",function(){var e=1060+2*$(".modal").length;$(this).css("z-index",e),$(this).on("shown.bs.modal",function(){$(this).next(".modal-backdrop").css("z-index",e-1)})})}),$(function(){$("body").on("click","[data-bs-toggle=tab-sameparent][data-bs-target]",function(){var e=$(this).closest(".tab-parent"),e=(e=e.length?e:$(this).parent()).find($(this).attr("data-bs-target"));e.closest(".tab-content").find("> .tab-pane").removeClass("active"),e.addClass("active"),$(this).closest(".nav-tabs").find(".nav-link").removeClass("active"),$(this).addClass("active")})}),$(function(){new bootstrap.Tooltip("html",{selector:'[data-bs-toggle="tooltip"]',container:"body"}),new bootstrap.Popover("body",{selector:'[data-bs-toggle="popover"]',trigger:"hover focus",html:!0});var a={usercard:{}};new bootstrap.Popover("body",{selector:"[data-usercard]",trigger:"hover focus",template:'<div class="popover popover-usercard border-0" role="tooltip"><div class="popover-arrow"></div><div class="popover-body"></div></div>',html:!0,content:function(){var t=$(this).attr("data-usercard");if(t.length)return a[t]||(a[t]=$('<div><i class="fa-solid fa-spinner fa-spin"></i></div>'),$.get("/apiv2/user/".concat(t),function(e){render(!1,"User_ProfilePopover",e,function(e){a[t].html(e),tracker.emit("userCard",{card:t})})},"json").fail(function(){a[t].html("<div>"+_("User not found")+"</div>")})),a[t]}}),$("body").on("hide.bs.popover",'[data-usercard], [data-bs-toggle="popover"]',function(e){var t=$(this),a=$("#"+$(this).attr("aria-describedby"));t.is("[data-allow-hide]")||(e.preventDefault(),setTimeout(function(){a.is(":hover")||t.attr("data-allow-hide",!0).popover("hide")},300),a.one("mouseleave",function(){t.attr("data-allow-hide",!0).popover("hide")})),t.removeAttr("data-allow-hide")})}),window.Chat7Cups={config:{debug:!1,apiPath:"/apiv2",nodeURL:null,typingBuffer:10,typingClearBuffer:3e3,serverTimeOffset:0,askOptsDelayMS:18e4,user:{},maxSessions:10,activeNodeChannels:[]},polling:{ChatList:{inprogress:!1,timer:null},RequestQue:{inprogress:!1,timer:null},UserRequests:{refreshTimeMS:12e4,checkTimeout:setTimeout(function(){return null},0)}},MutedUsers:[],ChatSessions:{},RequestQue:{},listeners:{},ChatRequest:{},bot:{activeSessions:{}},currentNoni:{screenName:"Noni",imgURL:PATH_CLOUDFRONT+"img/noniCup.jpg"},userTemps:{initialLoad:{}},toConsole:function(e,t){this.config.debug&&console.log("7Cups Chat: "+e,t||"")},init:function(e){var t,a=this;for(t in this.toConsole("Initialize 7 Cups Chat"),e=e||{})this.config[t]=e[t];if(!(this.config.nodeURL&&this.config.apiPath&&this.config.user&&this.config.user.userType&&this.config.user.userID))throw this.toConsole("Invalid Configuration.",this.config),"Invalid Chat7Cups Configuration";this.getChatList(),this.polling.ChatList.timer=this.polling.ChatList.timer||setInterval(function(){var e;null!=a&&null!=(e=a.Socket)&&e.connected||a.getChatList()},3e5),"l"===this.config.user.userType&&(this.getRequestQue(),this.polling.RequestQue.timer=this.polling.RequestQue.timer||setInterval(function(){var e;null!=a&&null!=(e=a.Socket)&&e.connected||a.getRequestQue()},3e5)),this.launchNodeJS(),this.checkRequestStatus()},standby:function(){var e,t;for(t in this.toConsole("Polling & Socket on Standby",this.polling),this.polling)this.polling[t].timer&&clearInterval(this.polling[t].timer);null!=this&&null!=(e=this.Socket)&&e.connected&&this.Socket.disconnect()},on:function(e,t){return void 0!==this.listeners[e]?this.listeners[e].push(t):this.listeners[e]=[t],this},trigger:function(e,t){if(void 0!==this.listeners[e])for(var a=this.listeners[e].slice(),n=0;n<a.length;n++)"function"==typeof a[n]&&a[n](t);return this},randomHash:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<32;a++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},endDiscussion:function(e,t){e&&this.ChatSessions[e]&&this.callAPI("GET","/chat/conversation/".concat(e,"/discussion/end"),{},t)},deleteMessages:function(e,t){this.toConsole("Request Delete Messages",arguments),e&&this.ChatSessions[e]&&(this.callAPI("DELETE","/chat/conversation/".concat(e,"/message/"),{},t),this.ChatSessions[e].messages=[])},removeMessage:function(e,t){this.toConsole("Request Remove Message",arguments),e&&(this.trigger("chat:removemessage",{convID:e.convID,msgHash:t}),e.messages)&&(e.messages=e.messages.filter(function(e){return e.msgHash!=t}))},heartMessage:function(t,a){this.toConsole("Request Heart Message",arguments),t&&this.ChatSessions[t]&&a&&(this.Socket.emit("sendConvAction",{action:"heartMsg",room:this.ChatSessions[t].nodeRoom,me:this.ChatSessions[t].me,msgHash:a}),this.callAPI("POST","/chat/conversation/".concat(t,"/message/").concat(a,"/heart"),{},function(){var e=Chat7Cups.ChatSessions[t];e.messages=e.messages.map(function(e){return e.msgHash==a&&e.hearts++,e})}))},saveMessageReaction:function(e,t,a,n){this.toConsole("Request ".concat(a," Message"),arguments),this.callAPI("POST","/chat/conversation/".concat(e,"/message/reaction/").concat(a),{msgID:t},function(e,t){n&&n(e,t)})},endLiveChat:function(e){this.toConsole("Request End to Live Chat Session",arguments),e&&this.ChatSessions[e]&&this.Socket.emit("sendConvAction",{action:"endLiveChat",room:this.ChatSessions[e].nodeRoom,me:this.ChatSessions[e].me})},sendTypingStatus:function(e){var t,a=moment().unix()+this.config.typingBuffer;this.ChatSessions[e]&&this.ChatSessions[e].user&&a!==(t=this.ChatSessions[e].user.isTyping||0)&&(0===a||t<moment().unix())&&(this.ChatSessions[e].user.isTyping=a,this.Socket.emit("sendConvAction",{action:"typingStatus",room:this.ChatSessions[e].nodeRoom,me:this.ChatSessions[e].me,userTypeID:this.ChatSessions[e].user.userTypeID,isTyping:!!a}))},setTopic:function(e,t){var a,n=this;e&&(t=t||e.discussion||{},e.discussion&&e.discussion.to&&clearTimeout(e.discussion.to),t.endTime=t.endTime||0,a=moment(t.endTime,"X").valueOf()-moment().valueOf(),t.Topic&&0<a&&(e.discussion={Topic:t.Topic,endTime:t.endTime,to:setTimeout(function(){n.clearTopic(e)},a)}),this.trigger("chat:newtopic",e))},clearTopic:function(e){this.toConsole("ending topic"),delete e.discussion,this.trigger("chat:cleartopic",e)},muteUser:function(e,t){this.MutedUsers.push(e),window.sessionStorage&&(window.sessionStorage.Chat7Cups_MutedUsers=this.MutedUsers),this.trigger("chat:removeusermessages",{userTypeID:e,convID:t})},getMutedUserArray:function(){return window.sessionStorage&&window.sessionStorage.Chat7Cups_MutedUsers?window.sessionStorage.Chat7Cups_MutedUsers:this.MutedUsers},isMutedUser:function(e){var t=this.getMutedUserArray();return Boolean(-1!==t.indexOf(e))},unmuteAll:function(){this.MutedUsers=[],window.sessionStorage&&(window.sessionStorage.Chat7Cups_MutedUsers=this.MutedUsers)},modRemoveMessage:function(e){this.toConsole("Request Mod Remove Message",e),this.callAPI("DELETE","/chat/conversation/".concat(e.convID,"/message/").concat(e.msgHash)),this.ChatSessions[e.convID]&&this.Socket.emit("sendConvAction",{action:"modRemoveMsg",room:this.ChatSessions[e.convID].nodeRoom,msgHash:e.msgHash,me:this.ChatSessions[e.convID].me})},sendMessage:function(e,t){var a,n,s={},o=this.ChatSessions[e.convID];e.msgBody=e.msgBody?e.msgBody.trim():"",e.msgBody.length?e.convID&&o?o.user.sendDisabled&&"memberacct"==o.user.sendDisabled?((s.error=s.error||{})[102]="Member account required to participate",this.toConsole("Error Sending Message",s),"function"==typeof t&&t(s)):(this.toConsole("Request Send Message",e),n={action:"newMessage",room:o.nodeRoom,me:o.me,message:e},a={convID:e.convID,comment:e.msgBody,msgHash:e.msgHash},e.quotedMessage&&(a.quotedMessage={imgURL:e.quotedMessage.imgURL,msgHash:e.quotedMessage.msgHash,msgBody:e.quotedMessage.msgBody,screenName:e.quotedMessage.screenName,userTypeID:e.quotedMessage.user.userTypeID}),o.lastSentMessage=e.msgBody,o.nodeRoom&&"b"!=o.otherType&&"n"!=o.otherType&&(n.message.convSide="other",n.message.chatRoomType=o.chatRoomType,n.message.otherUser={listType:o.otherUser.listType}),this.Socket.emit("sendConvAction",n),this.callAPI("POST","/chat/conversation/".concat(e.convID,"/message"),a,t),o.chatRoomType?(o.user.messagesSent=o.user.messagesSent||0,o.user.messagesSent++):(o.user.messagesSent=o.user.messagesSent||("l"===o.convSide?o.numMsgListener:o.numMsgUser),o.user.messagesSent++,o.otherType&&"b"===o.otherType&&(o.botMessageCount++,n={bot:o.currentBot.bot,botVersion:2,sender:"user",msgCount:o.botMessageCount,mode:o.currentBot.mode,stage:o.currentBot.stage},o.currentBot.replyToMode&&(n.replyToMode=o.currentBot.replyToMode),o.currentBot.replyToStage&&(n.replyToStage=o.currentBot.replyToStage),tracker.emit("botMessage",n)))):((s.error=s.error||{})[101]="ChatSession Not Found",this.toConsole("Error Sending Message",s),"function"==typeof t&&t(s)):((s.error=s.error||{})[100]="Empty Message Not Sent",this.toConsole("Error Sending Message",s),"function"==typeof t&&t(s))},chatSession:function(a,n){var s=this;this.ChatSessions[a]?"function"==typeof n&&n(this.ChatSessions[a]):this.callAPI("GET","/chat/conversation/".concat(a),{},function(e,t){200===t?(Chat7Cups.userTemps.initialLoad[e.convID]=!1,e.otherScreenNameInitials=null==(t=e.otherScreenName)?void 0:t.substring(0,2),e.otherCountry&&(e.otherCountryFlag=PATH_CLOUDFRONT+"img/countryFlags/"+e.otherCountry.toLowerCase()+".png"),e.user&&(e.user.currentMessages=0),e.init_numConvMessages=parseInt(e.numMsg),e.numConvMessages=parseInt(e.numMsg),e.otherUser={userType:e.otherType,screenName:e.otherScreenName},e.ratingPopped=e.ratingPopped&&0<e.ratingPopped,e.oldestMessageMsgTS=null,e.hasMutedUsers=Boolean(s.getMutedUserArray().length),e.initialized=!0,e.botTimer=!1,e.botMessageCount=0,e.currentBot={},e.protectedBotMessages=[],e.autoPing=!1,e.autoPingIdx=0,e.autoPingExec=!1,e.autoPingName=!1,e.allowEmpty=!1,s.ChatSessions[a]=e,s.setTopic(s.ChatSessions[a]),t=s.ChatSessions[a],s.toConsole("Load Chat Requested",t),t.nodeRoom?(s.toConsole("Chat Request Loaded",t),s.addActiveNodeChannels([t.nodeRoom])&&s.Socket.emit("sendConvAction",{room:t.nodeRoom,action:"enterRoom",me:t.me}),"function"==typeof n&&n(t)):t.error&&s.toConsole("Error Retreiving Chat",t.error)):(t=e.errors||[{code:400,message:"Error loading chat"}],"function"==typeof n&&n(null,t))}),this.trimSessions()},trimSessions:function(){var e,t=this,a=Object.values(this.ChatSessions).filter(function(e){return e.lastLeft});a.sort(function(e,t){return e.lastLeft-t.lastLeft}),(a=a.slice(this.config.maxSessions-1)).length&&(e=a.map(function(e){return e.nodeRoom}),this.removeNodeChannels(e),a.forEach(function(e){e=e.convID;delete t.ChatSessions[e]}))},getChatSessionMessages:function(n){var s=this,o=this;this.toConsole("Request Messages",n),this.chatSession(n.convID,function(a,e){if(e&&o.toConsole("Fetching chat session failed",e),a.messages){o.toConsole("Messages Loaded from Cache",a.messages);for(var t=0;t<a.messages.length;t++)o.loadCachedChatMessage(a,a.messages[t]);s.trigger("chat:getchatmessages",{session:a,processing:!1,canFetchPrevious:40<=a.messages.length})}else s.trigger("chat:getchatmessages",{session:a,processing:!0}),s.getChatMessages(n,function(e){var t;o.toConsole("Messages Downloaded",e),o.trigger("chat:getchatmessages",{session:a,processing:!1,canFetchPrevious:40<=(null==e?void 0:e.messages.length)}),e.serverTime&&(Chat7Cups.config.serverTimeOffset=(new Date).getTime()/1e3-e.serverTime),e.lastMessage&&(a.lastMessage=e.lastMessage),o.userTemps.initialLoad=Chat7Cups.userTemps.initialLoad||{},e.inChatroom&&(a.inChatroom=e.inChatroom),e.messages&&(e.messages=e.messages.map(function(e){var t;return _objectSpread(_objectSpread({},e),{},{user:_objectSpread(_objectSpread({},e.user||{}),{},{userType:null!=(t=e.userType)?t:null==(t=e.user)?void 0:t.userType,userTypeID:null!=(t=e.userTypeID)?t:null==(t=e.user)?void 0:t.userTypeID})})}),e.messages.forEach(function(e){o.loadChatMessage(a,e)}),o.userTemps.initialLoad[a.convID]=!1),null!=o&&null!=(t=o.ChatList)&&t.ChatList&&(t=o.ChatList.ChatList.find(function(e){return e.convID===a.convID}))&&(t.new=0,o.processChatList(o.ChatList)),e.bot&&o.trigger("chat:getchatmessagesBotinit",{bot:e.bot,session:a,autoPing:e.autoPing})})})},getChatMessages:function(e,t){var a=e.convID;delete e.convID,this.callAPI("GET","/chat/conversation/".concat(a,"/message/"),e,function(e){t&&t(e)})},getTips:function(a,n){var s=this;this.toConsole("Request Tips",a),this.callAPI("GET","/chat/conversation/".concat(a.convID,"/tips"),{},function(e){var t=s.ChatSessions[a.convID];t.tips=t.tips||{},t.tips.copy=e,n()})},cacheChatMessage:function(e,t){var a;t.msgTS=t.msgTS||moment().unix(),e.messages=e.messages||[],e.messages.push(t),e.messages.sort(function(e,t){return e.msgTS-t.msgTS}),e.chatRoomType&&((a=JSON.parse(JSON.stringify(t.user))).exp=moment(1e3*t.msgTS).add(30,"minutes").unix(),e.inChatroom=e.inChatroom||[],0<=(t=e.inChatroom.findIndex(function(e){return e.screenName===a.screenName}))?e.inChatroom[t]=a:e.inChatroom.push(a),e.inChatroom=e.inChatroom.filter(function(e){return e.exp>moment().unix()})),80<e.messages.length&&(e.messages.shift(),e.oldestMessageMsgTS=e.messages[0].msgID)},loadChatMessage:function(e,t,a){e.messages=e.messages||[],e.messages.find(function(e){return e.msgHash===t.msgHash})||this.isMutedUser(t.userTypeID)||(t.quotedMessage&&this.isMutedUser(t.quotedMessage.userTypeID)&&(t.quotedMessage.msgBody="You've hidden this user's messages"),this.cacheChatMessage(e,t),this.trigger("chat:newmessage",{session:e,message:t,chatActions:a})),e.isTyping&&e.isTyping.updateUser(t.user.screenName,!1)},loadCachedChatMessage:function(e,t){this.trigger("chat:newmessage",{session:e,message:t})},requestJIITSuggestion:function(e,t){this.callAPI("GET","/chat/conversation/".concat(e,"/message/recommendation"),{},function(e){t&&t(e)})},requestNewVideoSession:function(e,t){this.callAPI("POST","/chat/conversation/".concat(e,"/video"),{},function(e){t&&t(e)})},requestNewGameSession:function(e,t){this.callAPI("POST","/game/".concat(e=e||"connect4"),{},function(e){t&&t(e)})},getChatList:function(){var e,t=this;window.sessionStorage&&window.sessionStorage.ChatList&&null!=(e=this.config)&&null!=(e=e.user)&&e.userType&&null!=(e=this.config)&&null!=(e=e.user)&&e.userID&&(e=JSON.parse(window.sessionStorage.ChatList)).user&&e.user.userType&&e.user.userID&&e.user.userType==this.config.user.userType&&e.user.userID==this.config.user.userID&&(this.toConsole("Loading Chat List from Session Storage"),this.processChatList(e)),this.polling.ChatList.inprogress||(this.toConsole("Request Update Chat List"),this.polling.ChatList.inprogress=!0,this.callAPI("GET","/chat/conversation/",{},function(e){t.polling.ChatList.inprogress=!1,e.user&&(t.config.user=e.user,t.addActiveNodeChannels(e.user.nodeChannels||[]),t.processChatList({ChatList:e.conversations||[],user:{userType:e.user.userType,userID:e.user.userID}}))}))},processChatList:function(e){var n=this;this.toConsole("Process Chat List"),this.ChatList=e,window.sessionStorage&&(window.sessionStorage.ChatList=JSON.stringify(e)),this.ChatListFormatted=(e=>{for(var t={user:n.config.user,newChat:0,newMessages:0,ChatList:{pm:e.ChatList.filter(function(e){return!e.chatRoomType}),group:e.ChatList.filter(function(e){return e.chatRoomType})}},a=0;a<t.ChatList.pm.length;a++)t.ChatList.pm[a].new&&(t.newChat++,t.newMessages+=t.ChatList.pm[a].new);return t.ChatList.pm=t.ChatList.pm.sort(function(e,t){return"therapist"===e.otherListType&&"therapist"!==t.otherListType?-1:"therapist"!==e.otherListType&&"therapist"===t.otherListType?1:"b"===e.otherType!=("b"===t.otherType)?parseInt("b"===e.otherType)>parseInt("b"===t.otherType)?-1:1:parseInt(0<e.new)!=parseInt(0<t.new)?parseInt(0<e.new)>parseInt(0<t.new)?-1:1:e.lastMsgTime!=t.lastMsgTime?e.lastMsgTime>t.lastMsgTime?-1:1:0}),t.ChatList.group=t.ChatList.group.sort(function(e,t){return e.lastMsgTime!=t.lastMsgTime?e.lastMsgTime>t.lastMsgTime?-1:1:0}),t.ChatList.pm=t.ChatList.pm.map(function(e){return _objectSpread(_objectSpread({},e),{},{lastMsgTime:parseInt(e.lastMsgTime)?moment(1e3*e.lastMsgTime).fromNow():"No messages"})}),t.ChatList.group=t.ChatList.group.map(function(e){return _objectSpread(_objectSpread({},e),{},{lastMsgTime:parseInt(e.lastMsgTime)?moment(1e3*e.lastMsgTime).fromNow():"No messages"})}),t})(e),this.toConsole("ChatList",this.ChatListFormatted),this.trigger("update:ChatListFormatted",this.ChatListFormatted)},noderoomToSession:function(e){for(var t in this.ChatSessions)if(this.ChatSessions[t].nodeRoom&&this.ChatSessions[t].nodeRoom===e)return this.ChatSessions[t];return!1},addActiveNodeChannels:function(e){var t=this,a=[];return e.forEach(function(e){-1===t.config.activeNodeChannels.indexOf(e)&&(t.config.activeNodeChannels.push(e),a.push(e))}),!!a.length&&(null!=this&&null!=(e=this.Socket)&&e.connected?this.Socket.emit("addToRooms",a):this.launchNodeJS(),!0)},removeNodeChannels:function(e){var t,a=this;e.forEach(function(t){a.config.activeNodeChannels=a.config.activeNodeChannels.filter(function(e){return e!==t})}),e.length&&null!=this&&null!=(t=this.Socket)&&t.connected&&this.Socket.emit("leave",e)},launchNodeJS:function(){var a=this;this.toConsole("Request NodeJS Launch"),this.config.activeNodeChannels.length&&(this.toConsole("Channels Detected, Initializing Connection"),this.Socket?this.Socket.connected||this.Socket.connect():(this.Socket=io(this.config.nodeURL,{}),this.Socket.on("connect",function(){a.toConsole("Node Socket Connected"),a.Socket.emit("addToRooms",a.config.activeNodeChannels),a.config.user.requestQueFilter&&a.Socket.emit("subscribeChatRequestQueue",a.config.user.requestQueFilter),a.trigger("socket:connect")}).on("disconnect",function(e){a.toConsole("Node Socket Disconnected",e),a.trigger("socket:disconnect")}).on("chatRequestQueueUpdate",function(e){a.toConsole("Chat Request Queue Update",e),a.processQueListChange(e)}).on("notification",function(e){a.toConsole("Node Notification",e),e.msg=e.msg||"";var t=a.noderoomToSession(e.roomID);switch(0===e.msg.indexOf("globalMute_")&&(e.userTypeID=e.msg.replace("globalMute_",""),e.msg="globalMute"),e.msg){case"convUpdate":a.ChatList&&a.ChatList.ChatList&&e.updates?a.modifyChatList(e.updates):a.getChatList();break;case"statusChange":case"onlineChange":a.checkRequestStatus(),a.getChatList();break;case"modwarning":e.copy&&a.trigger("user:Alert",e);break;case"globalMute":a.muteUser(e.userTypeID,t.convID);break;case"startTopic":a.setTopic(t,e);break;case"endTopic":a.clearTopic(t)}}).on("recConvAction",function(e){a.toConsole("Conversation Action Received",e);var t=a.noderoomToSession(e.room);switch(e.action||null){case"modRemove":a.removeMessage(t,e.msgHash);break;case"newMessage":a.loadChatMessage(t,e.message,{showTips:!0,showTitleAlert:!0});break;case"censorAssist":a.trigger("chat:CensoredMsgAssist",{session:t,msgHash:e.msgHash});break;case"censorWarn":a.trigger("chat:CensoredMsgWarn",{session:t,msgHash:e.msgHash});break;case"enterRoom":a.trigger("chat:enterRoom",{session:t,screenName:e.screenName});break;case"heartMsg":a.trigger("chat:heartMsg",{session:t,msgHash:e.msgHash});break;case"endLiveChat":a.trigger("chat:endLiveChat",{session:t});break;case"typingStatus":a.updateIsTyping(t,e)}})))},updateIsTyping:function(n,e){var s=this;s.isMutedUser(e.userTypeID)||n&&n.user.screenName!==e.screenName&&(n.isTyping=n.isTyping||{users:{},updateUser:function(e,t){if(!t)return this.clear(e);this.update(e)},clear:function(e){delete this.users[e],s.trigger("chat:typingstatus",n)},update:function(e){var t=this,a=this.users[e]||{timeoutToClear:0};this.users[e]=a,clearTimeout(a.timeoutToClear),s.trigger("chat:typingstatus",n),a.timeoutToClear=setTimeout(function(){t.clear(e)},s.config.typingClearBuffer)},toArray:function(){var e,t=[];for(e in this.users)t.push(e);return t},toString:function(){var e="",t=this.toArray();return 1===t.length?e=t[0]+" is typing...":2===t.length?e=t[0]+" & "+t[1]+" are typing...":2<t.length&&(e=t.length+" users typing..."),e}},n.isTyping.updateUser(e.screenName,e.isTyping))},hideChat:function(e){var t={};t[e]={hidden:!0},this.callAPI("PUT","/chat/conversation/".concat(e),{hidden:!0}),this.modifyChatList(t)},modifyChatList:function(e){if(e&&this.ChatList&&this.ChatList.ChatList){var t,a=this.ChatList.ChatList;for(t in e)for(var n=0;n<a.length;n++){var s=a[n];s.convID&&s.convID===t&&(a[n]=_objectSpread(_objectSpread({},a[n]),e[t]))}this.processChatList(this.ChatList)}},getDiscussions:function(e){this.callAPI("GET","/chat/discussion/",{},e)},callAPI:function(e,t,a,n){this.toConsole("Request API Call:",{method:e,path:t,params:a});var s=new XMLHttpRequest,a=(e=e.toUpperCase(),t=this.config.apiPath+t+((e,t)=>Object.keys(t||{}).length&&["GET","DELETE"].includes(e)?"?"+Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&"):"")(e,a),((e,t)=>{if(t&&["POST","PUT"].includes(e))return JSON.stringify(t)})(e,a));s.open(e,t,!0),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Cache-Control","no-cache"),s.responseType="json",s.send(a),s.onload=function(){"function"==typeof n&&n(s.response,s.status)}},getRequestQue:function(){var e,t=this;"l"!==(null==(e=this.config)||null==(e=e.user)?void 0:e.userType)||this.polling.RequestQue.inprogress||(this.toConsole("Request Update Request Que"),this.polling.RequestQue.inprogress=!0,this.callAPI("GET","/chat/request/",{},function(e){t.polling.RequestQue.inprogress=!1,t.toConsole("Request Que Received:",e),e.ack&&"success"===e.ack&&(t.RequestQue={avgWait:e.avgWait||0,avgWaitFormatted:e.avgWait?Math.floor(e.avgWait/60)+":"+(e.avgWait%60<10?"0":"")+e.avgWait%60:0,que:{general:e.reqlist.filter(function(e){return"general"===e.reqType}),personal:e.reqlist.filter(function(e){return"personal"===e.reqType})}},t.formatRequestQue())}))},processQueListChange:function(t){if(this.RequestQue.que){var e;if(t.set&&(e=this.RequestQue.que[t.set.reqType]||[],t.latest=!0,e.push(t.set)),t.del)for(var a in this.RequestQue.que)this.RequestQue.que[a]=this.RequestQue.que[a].filter(function(e){return e.convID!==t.del.convID});this.formatRequestQue()}},formatRequestQue:function(){var e,t=this.RequestQue.que||{};for(e in t)t[e]&&(t[e]=t[e].map(function(e){return _objectSpread(_objectSpread({},e),{},{reqTime:e.reqTimeTS?moment(1e3*e.reqTimeTS).format("h:mm A"):""})}),t[e].sort(function(e,t){return e.hasOwnProperty("whitelabel")!==t.hasOwnProperty("whitelabel")?e.hasOwnProperty("whitelabel")>t.hasOwnProperty("whitelabel")?-1:1:e.reqTimeTS-t.reqTimeTS}));this.toConsole("Request Que Processed:",this.RequestQue),this.trigger("update:RequestQue",this.RequestQue)},acceptRequest:function(e,t){this.toConsole("Start Accept Request:",arguments),this.callAPI("POST","/chat/conversation/".concat(e,"/accept"),{},function(e){t(e)})},declineRequest:function(e,t){this.toConsole("Start Decline Request:",arguments),this.callAPI("POST","/chat/conversation/".concat(e,"/decline"),{},function(e){t(e)})},requestPersonalChat:function(e,t){this.callAPI("POST","/chat/conversation",e,function(e){t(e)})},setCurrentChatRequest:function(e){this.ChatRequest.convID=e,this.trigger("update:ChatRequest")},handleRequestStarted:function(e){this.ChatRequest={connecting:"request"===e.reqStatus},e.convID&&this.setCurrentChatRequest(e.convID),this.checkRequestStatus()},checkRequestStatus:function(){clearTimeout(this.polling.UserRequests.checkTimeout);var a=this;this.ChatRequest=this.ChatRequest||{},this.ChatRequest.redirected||this.ChatRequest.checking||!this.ChatRequest.convID?this.ChatRequest.redirected=!1:(this.ChatRequest.checking=!0,this.callAPI("GET","/chat/conversation/".concat(this.ChatRequest.convID,"/request"),{},function(e){a.ChatRequest=_objectSpread(_objectSpread({},a.ChatRequest),{},{connecting:"request"===e.reqStatus,checking:!1});var t={};if(e.reqStatus){switch(e.reqStatus){case"link":a.ChatRequest.convID=null,t={convID:e.convID,connected:!0};break;case"transfer":a.ChatRequest.convID=null,t={convID:e.xferTo,connected:!0},a.ChatRequest.redirected=!0;break;case"decline":a.ChatRequest.convID=null,t={statusMessage:e.reqStatusMessage,reqStatus:e.reqStatus};break;case"cancel":a.ChatRequest.convID=null,t={statusMessage:e.reqStatusMessage};break;case"miss":t={miss:!(a.ChatRequest.convID=null)},a.ChatRequest.redirected=!0;break;case"hold4message":t={leaveMessage:!0,convID:e.convID};break;case"hold4upgrade":t={hold4upgrade:!0},a.ChatRequest.redirected=!0;break;default:t=2==e.listOnline?{giveOpts:!0,convID:e.convID,reqTimeSecs:e.reqTime}:{leaveMessage:!0,convID:e.convID}}a.polling.UserRequests.checkTimeout=setTimeout(function(){a.checkRequestStatus()},a.polling.UserRequests.refreshTimeMS),a.trigger("update:ChatRequest",t)}}))},setAvailability:function(){}},$(function(){$.fn.setChatInterface=function(s){var e,o=$(this).is("[data-chat7cups-chatinterface]")?$(this).parent():$(this),t=(s=s||{},Chat7Cups.toConsole("Init Chat Interface",s),o.find("[data-chat7cups-chatinterface]"));return t.length&&(e=t.attr("data-chat7cups-chatinterface"))&&e!==s.convID&&Chat7CupsUI_Util.leaveConversation(t,e),render(!1,"Chat_Interface",s,function(e){o.html(e),o.find(".noniMenu").length&&(Chat7Cups.bot.activeSessions[s.convID]=new Chat7CupsUI_BotGui(s)),o.trigger("chat.interface.updated",s),Chat7CupsUI_Util.setActiveTab(s),s.convID&&(s.initialized?(Chat7Cups.getChatSessionMessages({convID:s.convID}),Chat7CupsUI_Util.initializeEmojiPicker(o),Chat7CupsUI_Util.initializeJitt(o),Chat7CupsUI_Util.positionGameCanvas(o),$(window).on("resize",function(){Chat7CupsUI_Util.positionGameCanvas(o)})):Chat7Cups.chatSession(s.convID,function(e,t){if(t){var a;switch(null==t||null==(a=t[0])?void 0:a.id){case"Account_AccountRequired":Chat7CupsUI_Util.createMemberAccount(function(){return o.setChatInterface(s)});break;case"Account_EmailVerificationRequired":Chat7CupsUI_Util.verifyEmail(function(){return o.setChatInterface(s)});break;case"Account_PhoneVerificationRequired":Chat7CupsUI_Util.verifyPhone(function(){return o.setChatInterface(s)});break;default:var n=t.map(function(e){return e.message}).join("<br>");bootbox.alert(n)}return o.setChatInterface()}return o.setChatInterface(e)}))}),o},$.fn.setChatSidebarInterface=function(e,a){var t=$(this),n=$(e);t.on("chat.interface.updated",function(e,t){render(!1,"Chat_Interface_Sidebar",{con:t,context:a},function(e){n.html(e)}),Chat7CupsUI_Util.showSharingCircleModal(a,t.convID)})};var e=new Chat7CupsUI_CustomEventHandler,t=new Chat7CupsUI_DOMEventHandler;Chat7Cups.on("chat:newmessage",e.handleNewMessage).on("chat:newtopic",e.handleNewTopic).on("chat:cleartopic",e.handleClearTopic).on("chat:typingstatus",e.handleTypingStatus).on("chat:enterRoom",e.handleEnterRoom).on("chat:JITTResponse",e.handleJITTResponse).on("chat:CensoredMsgWarn",e.handleCensoredMsgWarn).on("chat:CensoredMsgAssist",e.handleCensoredMsgAssist).on("chat:getchatmessages",e.handleGetChatMessages).on("chat:getchatmessagesBotinit",e.handleInitialBotMessages).on("chat:heartMsg",e.handleHeartMsg).on("chat:removeusermessages",e.handleRemoveUserMessages).on("user:Alert",e.handleUserAlert).on("chat:removemessage",e.handleRemoveMessage).on("chat:endLiveChat",e.handleEndLiveChat).on("update:RequestQue",e.handleUpdateRequestQue).on("update:ChatRequest",e.handleUpdateChatRequest).on("update:ChatListFormatted",e.handleChatListFormatted),$("body").on("click","[data-chat-menu-item-id]",t.handleMenuClick).on("click",'[data-chat7cups-action="hideChat"]',t.handleHideChatClick).on("click",'[data-chat7cups-action="showDiscussions"]',t.handleShowDiscussionsClick).on("click",'[data-chat7cups-action="chatparticipants"]',t.handleChatParticipantsClick).on("click","[data-chat7cups-modal]",t.handleModalClick).on("click","[data-chat7cups-chatinterface] [data-chat7cups-chatlink]",t.handleChatLink).on("submit",'[data-chat7cups-action="sendmessage"]',t.handleMessageSubmit).on("click",'[data-chat7cups-action="jitt"]',t.handleJITTButtonClick).on("click",'[data-chat7cups-action="likesuggestion"]',t.handleLikeSuggestionClick).on("click",'[data-chat7cups-action="dislikesuggestion"]',t.handleDisLikeSuggestionClick).on("click",'[data-chat7cups-action="closehelp"]',t.handleCloseHelpClick).on("keydown",'[data-chat7cups-action="sendmessage"] textarea[name="msgBody"]',t.handleChatFormKeydown).on("keyup",'[data-chat7cups-action="sendmessage"] textarea[name="msgBody"]',t.handleChatFormKeyup).on("click",'[data-chat7cups-action="blockuser"]',t.handleBlockUserClick).on("click",'[data-chat7cups-action="ratelistener"]',t.handleRateListenerClick).on("click",'[data-chat7cups-action="startvideo"]',t.handleStartVideoClick).on("click",'[data-chat7cups-action="joinvideo"]',t.handleJoinVideoClick).on("click",'[data-chat7cups-action="startgame"]',t.handleStartGameClick).on("click",'.chat-message-body a[href*="/game/match/"]',t.handleJoinGameClick).on("click",'[data-chat7cups-action="deletemessages"]',t.handleDeleteMessagesClick).on("click",'[data-chat7cups-action="heart"]',t.handleHeartClick).on("click",'[data-chat7cups-action="reply"]',t.handleReplyClick).on("click",'[data-chat7cups-action="replycancel"]',t.handleReplyCancelClick).on("click",'[data-chat7cups-action="showquotemsg"]',t.handleShowQuoteMessage).on("click",'[data-chat7cups-action="reaction"]',t.handleMessageReactionClick).on("click",'[data-chat7cups-action="chatroomrules"]',t.handleChatRoomRulesClick).on("click",'[data-chat7cups-action="crisisresources"]',t.handleCrisisResourcesClick).on("click",'[data-chat7cups-action="adviceandcrisis"]',t.handleAdviceAndCrisisResourcesClick).on("click",'[data-chat7cups-action="mute"]',t.handleMuteActionClick).on("click",'[data-chat7cups-action="mod-warn"]',t.handleModWarnClick).on("click",'[data-chat7cups-action="mod-remove"]',t.handleModRemoveClick).on("click",'[data-chat7cups-action="endlivechat"]',t.handleEndLiveChatClick).on("click",'[data-chat7cups-action="refertotherapy"]',t.handleReferToTherapyClick).on("click",'[data-chat7cups-request-action="accept"]',t.handleConnectingRequestClick).on("click","[data-chat7cups-pm-request-id]",t.handleRequestPersonalChat).on("click",'[data-chat7cups-request-action="decline"]',t.handleDeclineRequestClick).on("click",'[data-chat7cups-action="discussionend"]',t.handleDiscussionEndClick).on("click",'[data-chat7cups-action="discussionstart"]',t.handleDiscussionStartClick).on("click",'[data-chat7cups-action="unmute-all"]',t.handleUnmuteAllClick).on("click",'[data-chat7cups-action="togglefullscreen"]',t.handleToggleFullScreenClick).on("click",'[data-chat7cups-action="popout"]',t.handlePopoutClick).on("click",'[data-id="load-more-btn"]',t.handleLoadMoreClick).on("keyup",t.handleEspaceFullScreen).on("click",'[data-chat7cups-action="listenergethelp"]',t.handleListenerGetHelpClick).on("click",'[data-chat7cups-action="showNewMessages"]',t.handleShowNewMessagesModal).on("mouseover mouseout click",'[data-chat7cups-class="ratelistener"] [data-rating] > i',t.handleRateListenerStarEvents).on("click",'[data-id="seemore-trigger"]',t.handleSeeMoreClick).on("keyup",'[data-id="chat7cups-chatlist-filter-container"] [name="chat7cups-chatlist-filter-input"]',t.handleChatListFilter).on("mouseup wheel DOMMouseScroll mousewheel keyup touchmove mousedown",'[data-chat7cups-chatinterface] [data-id="container-scrolling"]',t.handleChatUserScroll),$(window).on("keydown mouseup wheel DOMMouseScroll mousewheel keyup touchmove mousedown touchstart touchmove touchend",t.handleNotIdle),StatusBar.bindEvents()});var StatusBar={refresh:function(){var t=this,a=t.$html?t.$html.height():0;render(!1,"Chat_Interface_StatusBar",Chat7Cups,function(e){t.$html?t.$html.replaceWith(e):$("body").append(e),t.$html=e,a!==t.$html.height()&&$(window).trigger("resize")})},bindEvents:function(){$("body").on("click",'[data-bottom-status-que="personalrequests"]',this.eventHandler.handlePersonalRequestModal),$("body").on("click",'[data-bottom-status-que="generalrequests"]',this.eventHandler.handleGeneralRequestModal),$("body").on("click",'[data-bottom-status-que="messages"]',this.eventHandler.handleNewMessagesModal)},eventHandler:{handlePersonalRequestModal:function(){Chat7CupsUI_Util.hideModals(),render(!1,"Chat_Modal_RequestQuePersonal",{chat:Chat7Cups},function(e){bootbox.dialog({title:_("Personal Conversation Requests"),message:e})})},handleGeneralRequestModal:function(){Chat7CupsUI_Util.hideModals(),render(!1,"Chat_Modal_RequestQueGeneral",{chat:Chat7Cups},function(e){bootbox.dialog({title:_("General Conversation Requests"),message:e,onShow:function(){Chat7CupsUI_Util.eventTracker.trackGeneralRequestViewed()}})})},handleNewMessagesModal:function(){Chat7CupsUI_Util.hideModals(),render(!1,"Chat_Interface_Modal_NewMessages",{chat:Chat7Cups},function(e){bootbox.dialog({title:_("New chat messages"),message:e})})}}},HeaderNotification={refresh:function(){var e,t=(null==(t=Chat7Cups)||null==(t=t.ChatListFormatted)?void 0:t.newMessages)||0;0<t?((e=$("#header-chat-messages")).removeClass("d-none"),e.find(".badge.rounded-pill").text(Math.min(t,99))):$("#header-chat-messages").addClass("d-none")}},LiveUIElements={refresh:function(){$("[data-request-count]").html(Chat7Cups.RequestQue.que.general.length);var e=Chat7Cups.RequestQue.avgWait,t=e/60,a={};a.hours=Math.floor(t/60),a.minutes=Math.floor(t%60),a.seconds=a.minutes<1?e:null,$("[data-average-wait]").html("\n            ".concat(a.hours?a.hours+" hr ":"","\n            ").concat(a.minutes?a.minutes+" min ":"","\n            ").concat(a.seconds?a.seconds+" sec ":"","\n        "))}},Chat7CupsUI_BotGui=_createClass(function e(t){var a=this;_classCallCheck(this,e),_defineProperty(this,"init",function(){a.session.botUtils={closeMenu:function(){return a.closeMenu()}},a.noniMenuButton.on("click",a.toggleMenu),a.comment.on("keyup",a.processKey),$("body").on("click",a.closeMenu)}),_defineProperty(this,"filterBotMenu",function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"/",s=[],e=(n.length&&"/"==n[0]&&(n=n.substring(1)),a.session.botMenu||[]),t=(e.forEach(function(e){var t,a;e.children?(a=[],e.children.forEach(function(e){e.name.toLowerCase().match(n)&&a.push(e)}),(t=a.length?a:null)&&s.push(_objectSpread(_objectSpread({},e),{},{children:t}))):e.name.toLowerCase().match(n)&&s.push(e)}),a);render(!1,"Chat_Interface_BotMenu",{menu:s},function(e){t.menuArea.html(e)})}),_defineProperty(this,"closeMenu",function(){a.noniMenu.addClass("d-none"),a.noniMenuButton.css("opacity",1),a.session.showNoniMenu=!1}),_defineProperty(this,"toggleMenu",function(e){e&&e.stopPropagation(),a.noniMenu.hasClass("d-none")?(a.noniMenuButton.css("opacity",.3),a.noniMenu.removeClass("d-none"),a.session.showNoniMenu=!0,a.session.botCommand=!1):(a.noniMenuButton.css("opacity",1),a.noniMenu.addClass("d-none"),a.session.showNoniMenu=!1,a.filterBotMenu())}),_defineProperty(this,"processKey",function(){var e=a.comment.val();!a.session.showNoniMenu&&e.length&&"/"==e[0]?a.toggleMenu():a.session.showNoniMenu&&a.filterBotMenu(e)}),this.session=t,this.chatInterface=$('[data-chat7cups-chatinterface="'.concat(t.convID,'"]')),this.chatForm=this.chatInterface.find('[data-chat7cups-action="sendmessage"]'),this.noniMenuButton=this.chatInterface.find(".noniMenu"),this.noniMenu=this.chatInterface.find(".noniBoxWrapper"),this.menuArea=this.noniMenu.find(".innerArea"),this.comment=this.chatInterface.find("textarea[name=msgBody]"),this.itemCount=0,this.session.showNoniMenu=!1,this.session.botCommand=!1,this.init()}),Chat7CupsUI_CustomEventHandler=_createClass(function e(){_classCallCheck(this,e),_defineProperty(this,"handleNewMessage",function(e){var t=e.session,a=e.message,e=e.chatActions,e=void 0===e?{}:e;a&&(e.showTips&&"n"!=t.otherType&&"b"!=t.otherType&&Chat7CupsUI_Util.listTips(t),e.showTitleAlert&&Chat7CupsUI_Util.showTitleAlert(t,a),Chat7CupsUI_Util.LoadChatMessage(t,a))}),_defineProperty(this,"handleNewTopic",function(e){Chat7CupsUI_Util.showDiscussionBar(e),Chat7CupsUI_Util.updateSidebarDiscussion(e),$('[data-chat7cups-chatinterface="'.concat(e.convID,'"] [data-chat7cups-action="discussionstart"]')).addClass("d-none")}),_defineProperty(this,"handleClearTopic",function(e){Chat7CupsUI_Util.clearDiscussionBar(e.convID),Chat7CupsUI_Util.updateSidebarDiscussion(e),$('[data-chat7cups-chatinterface="'.concat(e.convID,'"] [data-chat7cups-action="discussionstart"]')).removeClass("d-none")}),_defineProperty(this,"handleTypingStatus",function(e){$('[data-chat7cups-chatinterface="'+e.convID+'"] [data-id="status-bottom"]').text(e.isTyping?e.isTyping.toString():"")}),_defineProperty(this,"handleEnterRoom",function(e){e.session&&$('[data-chat7cups-chatinterface="'.concat(e.session.convID,'"]')).length&&e.session.chatRoomType&&e.session.convID&&e.screenName&&e.screenName!==e.session.user.screenName&&(Chat7CupsUI_Util.appendToChat(e.session.convID,'<div class="small py-2 text-muted"><i class="fa fa-user"></i> '+e.screenName+" has entered this room.</div>"),Chat7CupsUI_Util.scrollConversation(e.session))}),_defineProperty(this,"handleJITTResponse",function(e){var t;e.convID&&(t=$('[data-chat7cups-chatinterface="'.concat(e.convID,'"]'))).length&&e.convID&&render(!1,"Chat_Interface_JITTMessage",e,function(e){t.find('[data-id="suggestions"]').html(e).slideDown(500)})}),_defineProperty(this,"handleCensoredMsgWarn",function(a){$('[data-chat7cups-chatinterface="'+a.session.convID+'"]').each(function(){var e=$(this),t=e.find('.chat-message[data-message-hash="'.concat(a.msgHash,'"]'));t.length&&t.remove(),Chat7CupsUI_Util.appendToChat(a.session.convID,'<div class="alert alert-info shadow-sm">Something in your message appears to violate our terms of service (such as sharing personal contact information or social media accounts, or containing inappropriate content). 7 Cups depends upon you keeping your identity secure and private to protect everyone involved. Please also take care to show kindness and respect in every interaction here on 7 Cups.</div>'),a.session.lastSentMessage&&e.find("textarea[name=msgBody]").val(a.session.lastSentMessage),Chat7CupsUI_Util.scrollConversation(a.session)})}),_defineProperty(this,"handleCensoredMsgAssist",function(a){$('[data-chat7cups-chatinterface="'+a.session.convID+'"]').each(function(){var e=$(this),t=e.find('.chat-message[data-message-hash="'.concat(a.msgHash,'"]'));t.length&&t.remove(),Chat7CupsUI_Util.appendToChat(a.session.convID,'<div class="alert alert-info shadow-sm">Something in your message suggests that you might best be helped by another service. If you are in a potentially dangerous situation, please call 911, 988 or the Suicide Prevention Helpline at 1-800-273-8255. If I made a mistake, please rephrase your message to continue our conversation.</div>'),a.session.lastSentMessage&&e.find("textarea[name=msgBody]").val(a.session.lastSentMessage),Chat7CupsUI_Util.scrollConversation(a.session)})}),_defineProperty(this,"handleGetChatMessages",function(e){var t=$('[data-chat7cups-chatinterface="'+e.session.convID+'"] [data-id="messages-loading"]');e.processing?t.show():t.hide(),e.canFetchPrevious&&Chat7CupsUI_Util.showLoadMore(e.session.convID),Chat7CupsUI_Util.scrollConversation(e.session)}),_defineProperty(this,"handleInitialBotMessages",function(e){e.bot&&e.session&&Chat7CupsUI_Util.sendToBot(e.bot,e.session,e.autoPing)}),_defineProperty(this,"handleHeartMsg",function(e){var t,a,n=$('[data-chat7cups-chatinterface="'+e.session.convID+'"] [data-message-hash="'+e.msgHash+'"] [data-chat7cups-action="heart"]');n.length?(n.find('[data-id="heart-count"]').text(function(){var e=1,t=(n.hasClass("text-primary")&&(e=2),$(this).text().trim().split("+"));return 1===(e=2===t.length&&t[1]?parseInt(t[1])+1:e)?"":" +".concat(e)}),n.removeClass("text-gray-500"),n.addClass("text-primary")):(t=0,(e=$('[data-chat7cups-chatinterface="'+e.session.convID+'"] [data-message-hash="'+e.msgHash+'"] [data-id="hearts"]'))&&(e.hasClass("d-none")||((a=e.find('[data-id="heart-count"]').text()).length?2===(a=a.trim().split("+")).length&&(t=parseInt(a[1])):t=1),e.html('<span class="me-1 text-white"><i class="fa fa-heart"></i><span data-id="heart-count">'.concat(1<++t?" +".concat(t):"","</span></span>")),Chat7Cups.userTemps.gotHearts||"g"!=Chat7Cups.config.user.userType||(bootbox.dialog({title:"Congratulations! You just earned a Compassion Heart!",message:'<div class="text-center"><p>You said something kind and someone hearted your message. Sign up to be a member so you don&rsquo;t lose your compassion points. As a member, you can also give hearts, earn growth points, and unlock badges.</p><a href="/welcome/" class="btn btn-block btn-success">Become a Member</a><br /><span data-bs-dismiss="modal" style="cursor:pointer;color:#999;">No Thanks</span></div>',closeButton:!0,onEscape:!1}),Chat7Cups.userTemps.gotHearts=!0)))}),_defineProperty(this,"handleRemoveUserMessages",function(e){$('.chat-message[data-usertypeid="'+(e.userTypeID||null)+'"]').remove(),$('[data-quoted-msghash][data-usertypeid="'+(e.userTypeID||null)+'"]').find("span").html("You've hidden this user's messages"),$('[data-chat7cups-action="unmute-all"]').show()}),_defineProperty(this,"handleUserAlert",function(e){e.copy&&bootbox.alert(e.copy)}),_defineProperty(this,"handleRemoveMessage",function(e){e.convID&&e.msgHash&&$('.chat-message[data-convid="'+e.convID+'"][data-message-hash="'+e.msgHash+'"]').remove()}),_defineProperty(this,"handleEndLiveChat",function(e){var t;e.apiEndpoint="".concat(Chat7Cups.config.apiPath,"/chat/conversation/").concat(e.session.convID,"/rate"),e.session&&!e.session.chatRoomType&&"l"!=e.session.userType&&(t="Chat_Interface_Modal_EndLiveChat","m"===e.session.user.userType&&e.session.ratingPopped&&(t="Chat_Interface_Modal_RateListener"),render(!1,t,e,function(e){var a=bootbox.dialog({title:"Live Chat Complete",message:e});"Chat_Interface_Modal_RateListener"===t&&(Chat7CupsUI_Util.eventTracker.trackerRatingModalShown(),a.find("form").on("submit",function(e,t){var a=$(this).find('[name="overallRating"]').val();Chat7CupsUI_Util.eventTracker.trackListenerRating({rating:a})})),a.find("form").on("apiSuccess",function(){a.modal("hide")}).on("apiError",function(e,t){Array.isArray(t)&&t[0]&&a.find(".alert-resp").html(t[0])})}),$('[data-chat7cups-chatinterface="'+e.session.convID+'"]').parent().setChatInterface())}),_defineProperty(this,"handleUpdateRequestQue",function(){StatusBar.refresh(),LiveUIElements.refresh(),$("[data-chat7cups-request-id]").each(function(e){var t=$(e.target).attr("data-chat7cups-request-id");Chat7Cups.RequestQue.que.general.filter(function(e){return t===e.convID}).length||Chat7Cups.RequestQue.que.personal.filter(function(e){return t===e.convID}).length||$(e.target).css("visibility","hidden").slideUp(3e3)});for(var e in Chat7Cups.RequestQue.que)(t=>{render(!1,"Chat_Modal_".concat("general"===t?"RequestQueGeneral":"RequestQuePersonal"),{chat:Chat7Cups},function(e){$('[data-request-que="'.concat(t,'"]')).html(e)})})(e)}),_defineProperty(this,"handleUpdateChatRequest",function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(StatusBar.refresh(),e.connected&&($.removeCookie("reqID",{path:"/"}),$.removeCookie("reqConnecting",{path:"/"}),Chat7CupsUI_Util.connectChat(e.convID)),e.miss&&(window.location.href="/error/noListeners.php"),["decline","cancel"].includes[e.reqStatus]&&("decline"==e.reqStatus&&(e.statusMessage='Seems like this listener is unavailable at the moment. We appreciate your patience. Please try another listener or <a href="/connect/" class="text-hover-primary fw-semibold">make a General Request</a>'),$.removeCookie("reqID",{path:"/"}),$.removeCookie("reqConnecting",{path:"/"}),Chat7CupsUI_Util.showRequestStatusModal(e.statusMessage)),e.leaveMessage&&e.convID&&($.removeCookie("reqID",{path:"/"}),$.removeCookie("reqConnecting",{path:"/"}),$.removeCookie("reqConnected",{path:"/"}),Chat7CupsUI_Util.leaveMessage(e.convID)),e.giveOpts){var t=(new Date).getTime();for(t-=1e3*e.reqTimeSecs,t=Chat7Cups.config.askOptsDelayMS-t;t<0;)t+=Chat7Cups.config.askOptsDelayMS;setTimeout(function(){Chat7CupsUI_Util.giveOpts(e.convID)},t)}e.hold4upgrade&&-1===location.href.indexOf("backus/")&&0===Chat7Cups.ChatSession.length&&$.get("/connect/holdRequest.php",{holdReq:0},function(){Chat7Cups.checkRequestStatus()})}),_defineProperty(this,"handleChatListFormatted",function(){$('[data-chat7cups-template="Chat_Interface_ChatList"], [data-chat7cups-template="Chat_Interface_Modal_ChatList"]').each(function(){var a=$(this),e=$(this).attr("data-chat7cups-template"),t=window.location.pathname.includes("/dashboard"),n=new URLSearchParams(window.location.search).get("tab"),s=0,o=0;(Chat7Cups.ChatListFormatted.ChatList.group||[]).forEach(function(e){e.activeParticipantCount&&s++}),(Chat7Cups.ChatListFormatted.ChatList.pm||[]).forEach(function(e){e.new&&!e.hidden&&o++}),render(!1,e,{chat:Chat7Cups,showMore:t,numLiveGroups:s,numUnreadChats:o,activeTab:n},function(t){a.find("[data-chat7cups-chatlist]").length?["pm","group"].forEach(function(e){['[data-chat7cups-chatlist="'.concat(e,'"]'),'.nav-item [data-bs-target="[data-tab=chatlist-'.concat(e,']"]')].forEach(function(e){a.find(e).html(t.find(e).html())})}):a.html(t)})}),HeaderNotification.refresh(),StatusBar.refresh()})}),Chat7CupsUI_DOMEventHandler=_createClass(function e(){var t=this;_classCallCheck(this,e),_defineProperty(this,"handleMessageSubmit",function(e){e.preventDefault();var a,n,s={msgBody:$(this).find('[name="msgBody"]').val(),convID:$(this).find('[name="convID"]').val(),csrf:$(this).find('[name="csrf"]').val()};s.msgBody&&s.convID&&(a=Chat7Cups.ChatSessions[s.convID],n=$('[data-chat7cups-chatinterface="'.concat(a.convID,'"]')).find("[data-id=offline-message-div]"),a.quotedMessage&&Chat7CupsUI_Util.eventTracker.trackQuoteReply(s.convID),e={msgID:null,msgHash:Chat7Cups.randomHash(),msgBody:s.msgBody,quotedMessage:a.quotedMessage,user:_objectSpread({},a.user),convSide:"mine",convID:s.convID},Chat7CupsUI_Util.resetState(s.convID),Chat7Cups.sendMessage(e,function(e){if(Chat7Cups.toConsole("Message Send Response",e),e.action)switch(e.action){case"sendToBot":Chat7CupsUI_Util.sendToBot(e.bot,a,e.autoPing);break;case"createAccount":(e.error=e.error||{})[102]="Member account required to participate";break;case"requestRating":$('[data-chat7cups-action="ratelistener"]').removeClass("d-none"),$('[data-chat7cups-action="ratelistener"]').addClass("animate-pulse-warning"),a.ratingPopped=!0;break;case"requestRatingShow":$('[data-chat7cups-action="ratelistener"]').removeClass("d-none"),$('[data-chat7cups-action="ratelistener"]').addClass("animate-pulse-warning"),Chat7CupsUI_Util.loadRatingModal(),a.ratingPopped=!0;break;case"selfCareModal":bootbox.alert({title:"Care for Yourself First",message:"We all want to care for others, but we can only adequately care for other people if we are in good shape ourselves. If we are not in good shape, then we run the risk of hurting ourselves, others, and burning out. Take good care of ourselves means eating, exercising, and sleeping well. We care for you and want you to rest and take care of yourself. You matter and are important to us!"})}e.error&&("object"===_typeof(e.error)?e.error[102]&&bootbox.confirm({message:'<h3 class="text-center">In order to participate in this Chat, a Member Account is required. Would you like to create one now?</h3>',buttons:{confirm:{label:"Yes, Please",className:"btn-success"},cancel:{label:"no thanks",className:"btn-link text-muted"}},callback:function(e){e&&MemberAccountModal()}}):e.error&&"string"==typeof e.error&&(-1<e.error.indexOf("(Code 300)")?e.error="Invalid login or deactivated account.":-1<e.error.indexOf("(Code 304)")?e.error="This user is unavailable to chat with you, please select another.":-1<e.error.indexOf("Message blocked")&&(e.notShow=!0),$('[data-chat7cups-chatinterface="'+s.convID+'"]').each(function(){e.notShow||Chat7CupsUI_Util.appendToChat(a.convID,'<div class="alert alert-danger">'+e.error+"</div>")}),Chat7CupsUI_Util.scrollConversation(a)))}),a.autoPingExec?a.autoPingExec=!1:(Chat7CupsUI_Util.scrollConversation(a),Chat7CupsUI_Util.stopAutoPing(a)),""==s.msgBody&&!a.allowEmpty||("stop"==s.msgBody.trim().toLowerCase()?a.stopNoni=!0:a.waitForSend&&!a.stopNoni&&(a.waitForSend=!1,setTimeout(function(){n.html('<div class="" style="margin-bottom:.5em"><small><em>'+Chat7Cups.currentNoni.screenName+" is typing...</em></small></div>"),Chat7CupsUI_Util.scrollConversation(a);var e=["Got it","I see","Thank you","Alright","OK"],t=e[Math.floor(Math.random()*e.length)];setTimeout(function(){n.html("");parseInt((new Date).getTime()-1e3*Chat7Cups.config.serverTimeOffset);Chat7CupsUI_Util.LoadChatMessage(a,{msgID:null,msgHash:Chat7Cups.randomHash(),msgBody:t,userTypeID:"0GKvccLHkpyGnA!!",screenName:Chat7Cups.currentNoni.screenName,userType:"n",imgURL:Chat7Cups.currentNoni.imgURL,imgClass:Chat7Cups.currentNoni.imageClass,convSide:"other",convID:s.convID}),Chat7CupsUI_Util.scrollConversation(a),a.noniTimer=setTimeout(function(){return Chat7CupsUI_Util.talkToNoni(a)},2600)},1250)},750)),"Noni"!==(null==a?void 0:a.convID))||(a.numMsgSentSession=a.numMsgSentSession||0,a.numMsgSentSession++,a.numMsgSentSession%100!=0)||bootbox.dialog({title:"",message:['<div class="text-center">','<h3 class="fw-semibold">How is Noni doing?</h3>',"<p>"+_("7 Cups utilizes a standardized therapy feedback tool to measure how helpful Noni is. It measures understanding, relevance of topics and personality fit. It only takes 1 minute and is a simple 4-item scale.")+"</p>","<p>"+_("We will prompt you for this every so often, as it measures the efficacy of the work between you and Noni. We look forward to your open and honest feedback. Thank you!")+"</p>",'<a href="/assessment/NoniSessionRating/" class="btn btn-info">'+_("Share my feedback")+"</a><br>",'<button type="button" class="btn btn-link text-muted" data-bs-dismiss="modal">'+_("No thanks")+"</button>","</div>"].join(""),closeButton:!1}),$(this).find('[name="msgBody"]').val(""))}),_defineProperty(this,"handleJITTButtonClick",function(e){var t=$(this).closest("[data-chat7cups-chatinterface]").attr("data-chat7cups-chatinterface"),a=(Chat7CupsUI_Util.eventTracker.trackJITTEvent({action:"suggestion requested"}),Chat7Cups.trigger("chat:JITTResponse",{convID:t,processing:!0}),Chat7Cups.requestJIITSuggestion(t,function(e){Chat7Cups.trigger("chat:JITTResponse",{convID:t,message:e.message,error:null!=e&&e.message.includes("Try again later")?null==e?void 0:e.message:null})}),Chat7Cups.ChatSessions[t]);a.scrollPause=!1,Chat7CupsUI_Util.scrollConversation(a)}),_defineProperty(this,"handleCloseHelpClick",function(e){$(this).closest('[data-id="suggestions"]').slideUp(300)}),_defineProperty(this,"handleLikeSuggestionClick",function(e){$(this).closest('[data-id="suggestions"]').slideUp(300),Chat7CupsUI_Util.eventTracker.trackJITTEvent({action:"suggestion liked"})}),_defineProperty(this,"handleDisLikeSuggestionClick",function(e){$(this).closest('[data-id="suggestions"]').slideUp(300),Chat7CupsUI_Util.eventTracker.trackJITTEvent({action:"suggestion disliked"})}),_defineProperty(this,"handleMenuClick",function(e){var t=$(this).closest("[data-chat7cups-chatinterface]"),a=$(this).attr("data-trigger")||"/"+$(this).attr("data-code");t.find('[name="msgBody"]').val(a),t.find('[data-chat7cups-action="sendmessage"]').trigger("submit")}),_defineProperty(this,"handleHideChatClick",function(e){e.preventDefault(),e.stopPropagation(),Chat7Cups.hideChat($(this).closest("[data-chat7cups-chatlink]").attr("data-chat7cups-chatlink"))}),_defineProperty(this,"handleShowDiscussionsClick",function(e){var t=$('<div><div class="text-center"><i class="fa fa-spin fa-spinner fa-2x"></i></div></div>');bootbox.dialog({title:"Guided Discussions",message:t}),Chat7Cups.getDiscussions(function(e){render(!1,"Chat_Interface_Modal_DiscussionList",{list:e||[]},function(e){t.html(e)})})}),_defineProperty(this,"handleChatParticipantsClick",function(e){var t=$(this).attr("data-convid")||$(this).closest("[data-chat7cups-chatinterface]").attr("data-chat7cups-chatinterface"),t=Chat7Cups.ChatSessions[t];render(!1,"Chat_Interface_Modal_CurrentParticipants",{participants:t.inChatroom||[]},function(e){bootbox.dialog({title:'<i class="fa-regular fa-comments"></i> Recent Chatroom Participants',message:e})})}),_defineProperty(this,"handleModalClick",function(e){var a=$(this),n=a.closest("[data-chat7cups-chatinterface]"),t=["Chat","Interface","Modal",a.attr("data-chat7cups-modal")].join("_");render(!1,t,{chat:Chat7Cups},function(e){var e=$(e),t=bootbox.dialog({title:a.attr("data-modal-title")||null,message:e,className:a.attr("data-modal-class")||null});n.length&&e.on("click","[data-chat7cups-chatlink]",function(e){e.preventDefault();e=$(this).attr("data-chat7cups-chatlink");n.setChatInterface({convID:e}),t.modal("hide")})})}),_defineProperty(this,"handleChatLink",function(e){var t=$(this).attr("data-chat7cups-chatlink"),a=$(this).closest("[data-chat7cups-chatinterface]");a.length&&(e.preventDefault(),a.setChatInterface({convID:t}))}),_defineProperty(this,"handleChatFormKeydown",function(e){if(13===(e.which||e.keyCode||0)&&!e.shiftKey)return $(this).closest('[data-chat7cups-action="sendmessage"]').trigger("submit"),!1}),_defineProperty(this,"handleChatFormKeyup",function(e){$(this).val().length&&Chat7Cups.sendTypingStatus($(this).closest('[data-chat7cups-action="sendmessage"]').find('[name="convID"]').val())}),_defineProperty(this,"handleBlockUserClick",function(e){var t=$(this).closest("[data-chat7cups-chatinterface]").attr("data-chat7cups-chatinterface");t&&Chat7Cups.ChatSessions&&Chat7Cups.ChatSessions[t]&&render(!1,"Chat_Interface_Modal_BlockConnection",{apiEndpoint:"".concat(Chat7Cups.config.apiPath,"/chat/conversation/").concat(t,"/block"),session:Chat7Cups.ChatSessions[t]},function(e){var a=bootbox.dialog({title:"Block/Report "+(Chat7Cups.ChatSessions[t].otherScreenName||""),message:e});a.find("form").on("apiSuccess",function(e,t){a.modal("hide"),bootbox.dialog({title:"Block now active",message:"<p>Your report has been filed and will be reviewed by an admin. <br><br> We're sorry this chat didn't go well. To make sure you get the help you deserve, please accept $25 off your first month of therapy with the code 25OFF7C</p>",size:"large",buttons:{ok:{label:"Talk to a therapist",className:"btn-primary",callback:function(){window.location.href="/online-therapy/signup"}},cancel:{label:"Close",className:"btn-dark"}}})})})}),_defineProperty(this,"handleRateListenerClick",function(e){var t=$(this).closest("[data-chat7cups-chatinterface]").attr("data-chat7cups-chatinterface");t&&Chat7Cups.ChatSessions&&Chat7Cups.ChatSessions[t]&&Chat7CupsUI_Util.loadRatingModal(Chat7Cups.ChatSessions[t])}),_defineProperty(this,"handleStartVideoClick",function(){var t=$(this).closest("[data-chat7cups-chatinterface]").attr("data-chat7cups-chatinterface");Chat7CupsUI_Util.eventTracker.trackStartVideoClick(t),Chat7Cups.requestNewVideoSession(t,function(e){Chat7CupsUI_Util.appendToChat(t,'<a href="'.concat(e.hostRoomUrl,'"  target="_blank" class="card card-body">Join meeting with host link</a>'))})}),_defineProperty(this,"handleJoinVideoClick",function(){var e=$(this).closest("[data-chat7cups-chatinterface]").attr("data-chat7cups-chatinterface");Chat7CupsUI_Util.eventTracker.trackJoinVideoSessionClick(e)}),_defineProperty(this,"handleStartGameClick",function(){var a=$(this).closest("[data-chat7cups-chatinterface]"),n=a.attr("data-chat7cups-chatinterface");Chat7Cups.requestNewGameSession("connect4",function(e){var t;Chat7CupsUI_Util.eventTracker.trackStartGameClick(n),e.joinURL?(render(!1,"Chat_Interface_Modal_GameMatch",{iframe:{src:e.joinURL}},function(e){a.find('[data-id="game-interface"]').find('[data-id="game-container"]').html(e),a.find('[data-chat7cups-action="togglegameview"]').removeClass("d-none")}),e={msgBody:"Game session started. Click this link to join: ".concat(e.joinURL),convID:n},t=Chat7Cups.ChatSessions[e.convID],Chat7Cups.sendMessage({msgID:null,msgHash:Chat7Cups.randomHash(),msgBody:e.msgBody,user:_objectSpread({},t.user),convSide:"mine",convID:e.convID})):bootbox.alert("Error starting game session.")})}),_defineProperty(this,"handleJoinGameClick",function(e){e.preventDefault();var a=$(this),n=$(this).closest("[data-chat7cups-chatinterface]"),s=n.find('[data-id="game-interface"]'),e=n.attr("data-chat7cups-chatinterface");s.attr("link")!=a.attr("href")&&(Chat7CupsUI_Util.eventTracker.trackJoinGameClick(e),render(!1,"Chat_Interface_Modal_GameMatch",{iframe:{src:a.attr("href")}},function(e){var t=n.find('[data-chat7cups-action="togglegameview"]');s.find('[data-id="game-container"]').html(e),s.attr("link",a.attr("href")),s.hasClass("show")||t.trigger("click"),t.removeClass("d-none")}))}),_defineProperty(this,"handleJoinVideoClick",function(){var e=$(this).closest("[data-chat7cups-chatinterface]").attr("data-chat7cups-chatinterface");Chat7CupsUI_Util.eventTracker.trackJoinVideoSessionClick(e)}),_defineProperty(this,"handleDeleteMessagesClick",function(e){var t={convID:$(this).closest("[data-chat7cups-chatinterface]").attr("data-chat7cups-chatinterface")};t.convID&&render(!1,"Chat_Interface_Modal_DeleteMessages",t,function(e){bootbox.confirm({title:"Delete Messages",message:e,callback:function(e){e&&($('[data-chat7cups-chatinterface="'+t.convID+'"]').find('[data-id="container-messages"] *').remove(),Chat7Cups.deleteMessages(t.convID,function(e){e.error&&Chat7CupsUI_Util.appendToChat(t.convID,'<div class="alert alert-danger">'+e.error+"</div>")}))}})})}),_defineProperty(this,"handleHeartClick",function(e){var t=$(this),t=(t.addClass("pe-none"),{convID:t.closest("[data-chat7cups-chatinterface]").attr("data-chat7cups-chatinterface"),msgHash:t.closest("[data-message-hash]").attr("data-message-hash")});t.convID&&t.msgHash&&Chat7Cups.heartMessage(t.convID,t.msgHash)}),_defineProperty(this,"handleReplyClick",function(e){var t=$(this).closest("[data-chat7cups-chatinterface]"),a=t.attr("data-chat7cups-chatinterface"),a=Chat7Cups.ChatSessions[a],n=$(this).closest("[data-message-hash]").attr("data-message-hash"),s=null!=(s=a.messages.find(function(e){return e.msgHash==n}))?s:Chat7CupsUI_Util.getMessageDataFromDOM($(this).closest("[data-message-hash]")),a=(a.quotedMessage=s,'<div class="bg-white border-top card-body pt-1 pointer"><div data-quoted-msghash="'.concat(s.msgHash,'" class="d-flex align-items-center"><img class="rounded-circle" src="').concat(s.imgURL,'" style="width: 25px;height: 25px;"><span class="ms-2">').concat(s.screenName,'</span> <span class="p-2 ms-auto" data-chat7cups-action="replycancel"><i class="fa fa-times"></i></span></div><div class="mt-2">').concat(s.msgBody,"</div></div>"));t.find('[data-id="reply-post"]').html(a),t.find('[data-chat7cups-action="sendmessage"] [name="msgBody"]').trigger("focus")}),_defineProperty(this,"handleReplyCancelClick",function(e){var t=$(this).closest("[data-chat7cups-chatinterface]").attr("data-chat7cups-chatinterface"),t=Chat7Cups.ChatSessions[t];$(this).closest('[data-id="reply-post"]').html(""),t.quotedMessage=null}),_defineProperty(this,"handleShowQuoteMessage",function(e){var t=$(this).attr("data-quoted-msghash"),a=$(this).closest("[data-chat7cups-chatinterface]").find('[data-message-hash="'.concat(t,'"]')),n=$('[data-chat7cups-chatinterface] [data-id="container-scrolling"]'),t=a.offset()?Math.abs(a.offset().top-$(this).offset().top):0;n.animate({scrollTop:n.scrollTop()-t},500,function(){a.find('[data-id="bg"]').toggleClass("spotlight"),setTimeout(function(){n.one("scroll",function(){a.find('[data-id="bg"]').toggleClass("spotlight")})},2e3)})}),_defineProperty(this,"handleMessageReactionClick",function(e){var a=$(this),t=a.closest("[data-chat7cups-chatinterface]").attr("data-chat7cups-chatinterface"),n=a.attr("data-msgid"),s=a.attr("data-reactiontype");Chat7Cups.saveMessageReaction(t,n,s,function(e,t){200==t&&(a.parent().children('[data-chat7cups-action="reaction"]').addClass("text-gray-300").removeClass("text-gray-500 pointer").css({pointerEvents:"none"}),a.addClass("like"===s?"text-primary":"text-warning"))})}),_defineProperty(this,"handleChatRoomRulesClick",function(e){var t,a=$(this).closest("[data-chat7cups-chatinterface]").attr("data-chat7cups-chatinterface"),a=Chat7Cups.ChatSessions[a];a.chatroomRules&&(t="l"==a.chatRoomType?"Listener Chat Rules":"Group Chat Rules",render(!1,"Chat_Interface_Modal_ChatroomRules",{con:a},function(e){bootbox.dialog({title:t,message:e,closeButton:!0,onEscape:!1})}))}),_defineProperty(this,"handleCrisisResourcesClick",function(e){render(!1,"Chat_Interface_Modal_CrisisResources",{},function(e){bootbox.alert({title:"Crisis Resources",message:e})})}),_defineProperty(this,"handleAdviceAndCrisisResourcesClick",function(e){render(!1,"Training_Advice",null,function(e){bootbox.dialog({title:"Advice and Crisis Resources",message:e})}),Chat7CupsUI_Util.eventTracker.trackAdviceAndCris({action:"click",location:location})}),_defineProperty(this,"handleMuteActionClick",function(e){var t=$(this),a={userTypeID:t.closest(".chat-message").attr("data-usertypeid"),screenName:t.closest(".chat-message").attr("data-screenname"),convID:t.closest(".chat-message").attr("data-convid")};a.apiEndpoint="".concat(Chat7Cups.config.apiPath,"/chat/conversation/").concat(a.convID,"/report-user"),a.userTypeID&&a.screenName&&a.convID&&render(!1,"Chat_Interface_Modal_MuteUser",_objectSpread(_objectSpread({},a),{},{session:Chat7Cups.ChatSessions[a.convID]}),function(e){var t=bootbox.dialog({title:"Has <strong>"+a.screenName+"</strong> acted inappropriately or in violation of our Terms of Service?",message:e,closeButton:!0,onEscape:!1});e.find("form").on("apiSuccess",function(){Chat7Cups.muteUser(a.userTypeID,a.convID),t.modal("hide")})})}),_defineProperty(this,"handleModWarnClick",function(e){var t=$(this),a={userTypeID:t.closest(".chat-message").attr("data-usertypeid"),screenName:t.closest(".chat-message").attr("data-screenname"),convID:t.closest(".chat-message").attr("data-convid")};a.apiEndpoint="".concat(Chat7Cups.config.apiPath,"/chat/conversation/").concat(a.convID,"/warn"),a.userTypeID&&a.screenName&&a.convID&&Chat7Cups.ChatSessions[a.convID]&&Chat7Cups.ChatSessions[a.convID].chatroomRules&&(a.chatroomRules=Chat7Cups.ChatSessions[a.convID].chatroomRules,render(!1,"Chat_Interface_Modal_ModWarning",a,function(e){var t=bootbox.dialog({title:"Send ".concat(a.screenName," a warning"),message:e});e.find("form").on("apiSuccess",function(){t.modal("hide")})}))}),_defineProperty(this,"handleModRemoveClick",function(e){var t=$(this),a={convID:t.closest(".chat-message").attr("data-convid"),msgHash:t.closest("[data-message-hash]").attr("data-message-hash")};Chat7Cups.modRemoveMessage(a),Chat7Cups.ChatSessions[a.convID]&&Chat7Cups.ChatSessions[a.convID].chatRoomType&&-1!==["lmg","lm"].indexOf(Chat7Cups.ChatSessions[a.convID].chatRoomType)&&t.closest(".chat-message").find('[data-chat7cups-action="mod-warn"]').trigger("click")}),_defineProperty(this,"handleEndLiveChatClick",function(e){Chat7Cups.endLiveChat($(this).closest("[data-chat7cups-chatinterface]").attr("data-chat7cups-chatinterface"))}),_defineProperty(this,"handleReferToTherapyClick",function(e){var t=$(this).attr("data-convid"),t=$('[data-chat7cups-chatinterface="'.concat(t,'"]'));$('[data-chat7cups-action="sendmessage"] textarea[name="msgBody"]',t).val(_("Have you considered seeing a therapist for your issue? I think it might be helpful for you. I'm happy to keep chatting with you, but I would recommend that you also check out our 7 Cups therapists here: 7cups.com/online-therapy")),bootbox.alert('<h3 class="text-center">'+_("We have inserted a referral into your message box. Just send it or edit it into your own words.")+"</h3>")}),_defineProperty(this,"handleRequestPersonalChat",function(){var e=$(this),t=e.attr("data-chat7cups-pm-request-id"),a=e.attr("data-pm-request-usertype"),n="1"===e.attr("data-pm-request-bypassad");e.attr("html",e.html()),e.html("<i class='fa-solid fa-spin fa-spinner'></i>"),Chat7CupsUI_Util.requestPersonalChat({userID:t,userType:a,bypassAd:n},function(){e.html(e.attr("html"))})}),_defineProperty(this,"handleConnectingRequestClick",function(e){var a=$(this).closest("[data-chat7cups-request-id]").attr("data-chat7cups-request-id"),t=$(this).closest("[data-chat7cups-request-id]").attr("data-reqtype"),t=Chat7Cups.RequestQue.que[t].find(function(e){return e.convID===a});t&&("general"===t.reqType?Chat7CupsUI_Util.eventTracker.trackGeneralRequestTaken(t):Chat7CupsUI_Util.eventTracker.trackPersonalRequestAction("accept",t)),render(!1,"Chat_Interface_Modal_ConnectingRequest",{},function(t){Chat7CupsUI_Util.hideModals(),bootbox.dialog({message:t,onEscape:!1,backdrop:null,closeButton:!1}),Chat7Cups.acceptRequest(a,function(e){Chat7Cups.toConsole("ACCEPTREQUESTREC",e),"success"===e.ack&&e.convID?window.location.href="/chat/?c="+e.convID:e.error&&t.html('<div class="alert alert-resp alert-danger">'.concat(e.error,'</div><div class="text-center"><button data-bs-dismiss="modal" class="btn btn-primary mt-4 m-t-md">Close</button></div>'))})})}),_defineProperty(this,"handleDeclineRequestClick",function(e){var t=$(this).closest("[data-chat7cups-request-id]"),a=t.attr("data-chat7cups-request-id"),n=t.attr("data-reqtype");bootbox.dialog({message:'<div class="text-center"><h1>Decline Chat Request?</h1><p>If you are unable to take this request, no problem. We recommend no more than 2 live chats at a time. You can dismiss this request, but please note it may impact your personal response rate. You can avoid this in the future by adjusting your availability settings. Do this by clicking on your picture at the top right of any screen on the site and select from the drop down. Red indicates offline, yellow indicates busy and green indicates available. (Note: On the app, the status button is located on your preferences tab.)</p></div>',buttons:{cancel:{label:"cancel",className:"btn-secondary"},decline:{label:"Decline Request",className:"btn-danger",callback:function(){var e=Chat7Cups.RequestQue.que[n].find(function(e){return e.convID===a});Chat7Cups.RequestQue.que[n]=Chat7Cups.RequestQue.que[n].filter(function(e){return e.convID!==a}),t.remove(),Chat7Cups.declineRequest(a),void 0!==e&&"personal"===e.reqType&&Chat7CupsUI_Util.eventTracker.trackPersonalRequestAction("decline",e)}}}})}),_defineProperty(this,"handleDiscussionEndClick",function(e){var t=$(this),a=t.closest("[data-chat7cups-chatinterface]").attr("data-chat7cups-chatinterface");t.remove(),Chat7Cups.endDiscussion(a,function(){Chat7Cups.trigger("chat:cleartopic",Chat7Cups.ChatSessions[a])})}),_defineProperty(this,"handleDiscussionStartClick",function(e){var t={convID:$(this).closest("[data-chat7cups-chatinterface]").attr("data-chat7cups-chatinterface")};t.apiEndpoint="".concat(Chat7Cups.config.apiPath,"/chat/conversation/").concat(t.convID,"/discussion/start"),render(!1,"Chat_Interface_Modal_DiscussionForm",t,function(e){var a=bootbox.dialog({title:"New Discussion Topic",message:e});e.find("form").on("apiSuccess",function(e,t){a.modal("hide")})})}),_defineProperty(this,"handleListenerGetHelpClick",function(e){e.preventDefault(),Chat7CupsUI_Util.eventTracker.trackClickChatHelpButton();e=$(this).attr("href");window.open(e,"_blank")}),_defineProperty(this,"handleShowNewMessagesModal",function(e){e.preventDefault(),StatusBar.eventHandler.handleNewMessagesModal()}),_defineProperty(this,"handleLoadMoreClick",function(){var e=$(this).closest("[data-chat7cups-chatinterface]").attr("data-chat7cups-chatinterface");Chat7CupsUI_Util.fetchPreviousConversation(e)}),_defineProperty(this,"handlePopoutClick",function(e){e.preventDefault(),e.stopPropagation();var t,a,e=$(this).attr("data-convId");e&&(t=.33*$(window).width(),a=.66*$(window).height(),window.open("/chat/standalone.php?c=".concat(e),"Chat-".concat(e),"width=".concat(t,",height=").concat(a)))}),_defineProperty(this,"handleToggleFullScreenClick",function(){"true"===$("#chat-holder").attr("data-fullscreen-active")?Chat7CupsUI_Util.exitFullScreen():Chat7CupsUI_Util.makeFullScreen()}),_defineProperty(this,"handleEspaceFullScreen",function(e){"Escape"===e.key&&"true"===$("#chat-holder").attr("data-fullscreen-active")&&Chat7CupsUI_Util.exitFullScreen()}),_defineProperty(this,"handleUnmuteAllClick",function(e){for(var t in $('[data-chat7cups-action="unmute-all"]').hide(),Chat7Cups.unmuteAll(),$(".chat-message").show(),Chat7Cups.ChatSessions)Chat7CupsUI_Util.scrollConversation(Chat7Cups.ChatSessions[t])}),_defineProperty(this,"handleChatListFilter",function(e){var t=$(this),a=t.closest('[data-id="chat7cups-chatlist-filter-container"]'),n=t.val().toLowerCase();$("[data-chat7cups-chatlink]",a).each(function(){var e=-1!==$(this).text().toLowerCase().indexOf(n);$(this).toggleClass("d-none",!e)})}),_defineProperty(this,"handleSeeMoreClick",function(e){var t=$(this);"true"==t.attr("active")?(t.css({bottom:"1px",left:"unset",maxHeight:"6.1em"}),t.parent().css({maxHeight:"6.1em",overflow:"hidden"}),t.addClass("position-absolute").addClass("ps-4"),t.text("...".concat(_("See more"))),t.attr("active","false")):(t.css({position:"unset",bottom:"-20px"}),t.parent().css({maxHeight:"none",overflow:"unset"}),t.removeClass("position-absolute").removeClass("ps-4"),t.attr("active","true"),t.text("...".concat(_("See less"))))}),_defineProperty(this,"handleEmojiPickerClick",function(e){var o;$("[data-chat7cups-chatinterface]").length&&(o=$($(this).closest('[data-chat7cups-action="sendmessage"]')).find('[name="msgBody"]'),render(!1,"Element_EmojiPicker",{},function(e){bootbox.dialog({title:_("Select Emoji"),message:e,onEscape:!0,backdrop:!0,closeButton:!0}).on("shown.bs.modal",function(e){var s=$(this);s.on("click",".sc-emoji-picker-emoji",function(e){var t=o.prop("selectionStart")||0,a=o.val(),n=a.substring(0,t),a=a.substring(t,a.length);o.val(n+$(this).text()+a).trigger("focus").prop("selectionEnd",t+$(this).text().length),s.modal("hide")}).on("input",".sc-emoji-picker-input",function(){var e=this.value;""!=e?$(this).closest(".sc-emoji-picker").find(".sc-emoji-picker-emoji:not([title*='"+e+"'])").hide():$(this).closest(".sc-emoji-picker").find(".sc-emoji-picker-emoji").show()}).on("click",".nav-link",function(e){$(this).closest(".nav").find(".nav-link.active").removeClass("active"),$(this).addClass("active")})})}))}),_defineProperty(this,"handleRateListenerStarEvents",function(e){var t=$(this).closest("[data-rating]"),a="mouseout"===e.type?t.find('[name="overallRating"]').val()||0:parseInt($(this).attr("data-value")||0),n="";5<=a?n="Loved it! Awesome chat!":4<=a?n="I liked it, helpful chat.":3<=a?n="It went okay.":2<=a?n="Could have gone better.":1<=a&&(n="This was not a helpful chat."),t.find("> i").removeClass("fa-solid text-warning").addClass("fa-regular"),t.find("> i:lt("+a+")").removeClass("fa-regular").addClass("fa-solid text-warning"),"click"===e.type&&t.find('[name="overallRating"]').val(a),t.find('[data-id="ratingText"]').text(n)}),_defineProperty(this,"handleChatUserScroll",function(e){var t=Chat7Cups.ChatSessions[$(this).closest("[data-chat7cups-chatinterface]").attr("data-chat7cups-chatinterface")];"mousedown"===e.type?t.scrollPause=!0:(e=$(this)[0].scrollHeight-($(this).scrollTop()+$(this).innerHeight()),t.scrollPause=20<e),Chat7Cups.toConsole("AutoScroll",t.scrollPause?"Paused":"Active")}),_defineProperty(this,"userActivityCnt",0),_defineProperty(this,"handleNotIdle",function(e){t.userActivityCnt++})}),Chat7CupsUI_Util={jittTooltipAutoLoad:!1,initializeJitt:function(e){var t;this.jittTooltipAutoLoad||(t=$('form[data-chat7cups-action="sendmessage"] [data-chat7cups-action="jitt"][data-bs-toggle="tooltip"]',e).first()).length&&(t.tooltip("show"),setTimeout(function(){t.tooltip("hide")},5e3),this.jittTooltipAutoLoad=!0)},positionGameCanvas:function(e){var t=e.find('[data-id="container-scrolling"]');e.find("#offcanvasTop").css({top:t.offset().top,left:t.offset().left,right:t.offset().left})},initializeEmojiPicker:function(e){function t(e){var t=s.prop("selectionStart")||0,a=(n=s.val()||"").substring(0,t),n=n.substring(t,n.length);s.val("".concat(a).concat(e).concat(n)).trigger("focus").prop("selectionEnd",t+e.length)}var s=$('[name="msgBody"]',e),e=$("[data-emoji-picker-target]",e);e.off("click").on("click",function(){new EmojiPicker(t).renderPicker()})},strip_tags:function(e,a){e="string"!=typeof e?"":e,a=(((a||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var t=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,n=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,e=e.replace(n,"").replace(t,function(e,t){return-1<a.indexOf("<"+t.toLowerCase()+">")?e:""});return t.test(e)||n.test(e)?this.strip_tags(e,a):e},encodeMsg:function(e){return e=(e="string"!=typeof e?"":e).replace(/\b(https?:\/\/)?((?:[\w\-]+\.)?[\w\-]{1,63}\.[\w\-]{1,63}(?:\/[\w\/\-\.\_\~\:\?\#\[\]\@\!\$\&\'\(\)\*\+\,\;\=\%]*)?)\b/gi,function(e,t,a){return'<a href="'+(t=void 0!==t&&0<t.length?t:"http://")+a+'" target="_blank" rel="noreferrer">'+e.toString()+"</a>"})},exitFullScreen:function(){var e=$("#chat-holder"),t=e.attr("data-initial-style");e.attr("style",t),e.find(".card-header").first().removeAttr("style"),e.find(".card").first().removeAttr("style"),$("#chat-holder i.fa-compress.fa-fw").addClass("fa-expand").removeClass("fa-compress fa-fw"),e.attr("data-fullscreen-active",!1)},makeFullScreen:function(){var e=$("#chat-holder"),t=e.attr("style");e.attr("data-initial-style",t),e.css(_defineProperty({position:"fixed",width:"100%",height:"100%",top:0,bottom:0,left:0,right:0,zIndex:2e3,borderRadius:0,padding:0},"zIndex",1030)),e.find(".card-header").first().css({borderRadius:0}),e.find(".card").first().css({borderRadius:0}),$("#chat-holder i.fa-expand").removeClass("fa-expand").addClass("fa-compress fa-fw"),e.attr("data-fullscreen-active",!0)},updateSidebarDiscussion:function(e){var t=$('[data-chat7cups-sidebar="'.concat(e.convID,'"] [data-id="discussion-container"]'));e.discussion&&e.discussion.Topic?(t.removeClass("d-none"),$('[data-id="discussion-container-topic"]',t).text(e.discussion.Topic)):t.addClass("d-none")},showDiscussionBar:function(t){render(!1,"Chat_Interface_DiscussionBar",t,function(e){$('[data-chat7cups-chatinterface="'.concat(t.convID,'"] [data-id="discussion-bar"]')).html(e)})},clearDiscussionBar:function(e){$('[data-chat7cups-chatinterface="'.concat(e,'"] [data-id="discussion-bar"]')).html("")},startAutoPing:function(a,n){var s;void 0!==n&&(a.otherUser&&(a.autoPingName=a.otherUser.screenName),Chat7CupsUI_Util.stopAutoPing(n),a.autoPingIdx=0,(s=function(t){a.autoPing=setTimeout(function(){var e;window.selectData?s(0):a.otherUser&&a.otherUser.screenName==a.autoPingName&&(a.autoPingExec=!0,(e=$('[data-chat7cups-chatinterface="'.concat(a.convID,'"]'))).find('[name="msgBody"]').val("/autoping "+n[t].stage),e.find('[data-chat7cups-action="sendmessage"]').trigger("submit"),a.autoPingIdx=t+1,n.length-1>=a.autoPingIdx)&&(Chat7Cups.toConsole("Setting New Ping",a.autoPingIdx),s(a.autoPingIdx))},1e3*n[t].delay)})(0))},stopAutoPing:function(e){Chat7Cups.toConsole("Resetting auto ping"),e.autoPing&&clearTimeout(e.autoPing)},talkToNoni:function(t){var e,a,n;t.stopNoni||(e=$("[data-chat7cups-chatinterface=".concat(t.convID,"]")),a=e.find("[data-id=offline-message-div]"),t.waitForSend=!1,clearTimeout(t.noniTimer),t.chatRoomType)||"l"==t.user.userType||0!=t.numMsgListener||"general"!=t.reqType&&"general_therapy"!=t.reqType&&"personal_therapy"!=t.reqType||"request"!=t.reqStatus||(n=-1,e.find("[data-nonimsg]").each(function(){n=parseInt($(this).attr("data-nonimsg"))>parseInt(n)?parseInt($(this).attr("data-nonimsg")):n}),"general"==t.reqType&&-1==n&&(e.find('[data-id="container-messages"]').append('<div class="alert text-muted"><i class="fa-solid fa-info-circle"></i> You are currently on a waiting list for a listener. Noni is a bot who will chat with you until your listener arrives. Anything you say here will be viewable to the listener you connect to.</div>'),Chat7CupsUI_Util.scrollConversation(t)),$.post("/connect/talkToNoni.php",{convID:t.convID,lastNoniMsg:n},function(e){Chat7Cups.toConsole("##standard noni delay",3900),e&&e.message?(-1==n&&Chat7CupsUI_Util.eventTracker.trackNoniMessage(n+1),Chat7Cups.currentNoni.screenName=e.message.screenName,Chat7Cups.currentNoni.imgURL=e.message.imgURL,Chat7Cups.currentNoni.imageClass=e.message.imageClass,a.html("<div><small><em>"+e.message.screenName+" is typing...</em></small></div>"),Chat7CupsUI_Util.scrollConversation(t),Chat7Cups.toConsole("####noni typing",3900),setTimeout(function(){a.html("");parseInt((new Date).getTime()-1e3*Chat7Cups.config.serverTimeOffset);Chat7CupsUI_Util.LoadChatMessage(t,e.message),Chat7CupsUI_Util.scrollConversation(t),Chat7CupsUI_Util.eventTracker.trackBotMessage({msg:n+1,msgid:e.tag||null}),e.delay&&0<e.delay?(Chat7Cups.toConsole("######noni delaying to talk",1e3*e.delay*.65),t.noniTimer=setTimeout(Chat7CupsUI_Util.talkToNoni,1e3*e.delay*.65)):waitForSend=!0},3900)):e.delay&&e.delay<0&&(waitForSend=!0)},"json"))},sendToBot:function(e,a,n){if(e.length){a.protectedBotMessages=[];for(var t=0;t<e.length;t++)a.protectedBotMessages.push(e[t].msgHash);a.botTimer&&(clearTimeout(a.botTimer),a.botTimer=!1);var s=e.shift();o=s,i=e,a.botTimer=setTimeout(function(){function e(){t.html("");var e=a.protectedBotMessages.indexOf(o.msgHash),e=(a.protectedBotMessages.splice(e,1),Chat7Cups.cacheChatMessage(a,o),$("<span>".concat(o.msgBody,"</span>")).text());if(Chat7Cups.modifyChatList(_defineProperty({},a.convID,{lastMsg:50<e.length?e.substr(0,50)+"...":e,lastMsgTime:moment().unix()})),Chat7CupsUI_Util.LoadChatMessage(a,o,function(){var e;o.msgBody.includes("<img")&&(e=$("<div>").html(o.msgBody).find("img").attr("src"),$('<img src="'.concat(e,'">')).on("load",function(){Chat7CupsUI_Util.scrollConversation(a)}))}),Chat7CupsUI_Util.scrollConversation(a,'[data-message-hash="'.concat(o.msgHash,'"]')),a.botMessageCount++,o.tracking&&(a.currentBot=o.tracking,Chat7CupsUI_Util.eventTracker.trackBotMessage({botVersion:2,sender:"bot",msgCount:a.botMessageCount,mode:a.currentBot.mode,stage:a.currentBot.stage}),"introTherapy"==a.currentBot.mode))switch(a.currentBot.stage){case"account1":Chat7CupsUI_Util.eventTracker.trackOnlineTherapy({step:"loadmoreinfo"});break;case"confirm":Chat7CupsUI_Util.eventTracker.trackOnlineTherapy({step:"completemoreinfo"});break;case"therapistLink":case"waitForOK":Chat7CupsUI_Util.eventTracker.trackOnlineTherapy({step:"loadagreement"})}i.length?Chat7CupsUI_Util.sendToBot(i,a):Chat7CupsUI_Util.startAutoPing(a,n)}var t=$("[data-chat7cups-chatinterface=".concat(a.convID,"]")).find("[data-id=offline-message-div]");o.typingTime?(a.noniButtonsOnly&&Chat7CupsUI_Util.lockState(),t.html("<div><small><em>"+o.screenName+" is typing...</em></small></div>"),Chat7CupsUI_Util.scrollConversation(a),a.botTimer=setTimeout(function(){e()},1e3*o.typingTime)):e()},1e3*o.delayTime)}var o,i},isMobileApp:function(){return!("undefined"==typeof isApp||!isApp)},appendToChat:function(e,t){var a=$('[data-chat7cups-chatinterface="'.concat(e,'"] [data-chat-date-group]')).last();(a=a.length?a:$('[data-chat7cups-chatinterface="'.concat(e,'"] [data-id="container-messages"]'))).append(t)},renderDateGroupDiv:function(e,t){var a=moment(1e3*t.msgTS).format("YYYY"),n=moment().format("YYYY"),s=moment(1e3*t.msgTS).format(a===n?"ddd MMM D":"ddd MMM D YYYY"),o=moment(1e3*t.msgTS).format("YYYY-MM-DD"),i=$('[data-chat-date-group="'.concat(o,'"]')),r=[];return $('[data-chat7cups-chatinterface="'.concat(e.convID,'"] [data-id="container-messages"]')).each(function(){var e,t=$(this),a=$(i,t);a.length||(a=$('<div data-chat-date-group="'.concat(o,'"><div data-id="divider" class="text-center sticky-top py-3" style="z-index:900;pointer-events:none;"><span class="rounded-pill text-bg-light py-1 px-3">').concat(s,"</span></div></div>")),(e=(e=(e=$("[data-chat-date-group]",t).map(function(){var e=moment($(this).attr("data-chat-date-group"));return moment(o)<e?e:null}).get()).length?moment.min(e):null)?$('[data-chat-date-group="'.concat(e.format("YYYY-MM-DD"),'"]'),t):null)?a.insertBefore(e):t.append(a)),r.push(a)}),r},renderChatRow:function(e,n,s){Chat7CupsUI_Util.renderDateGroupDiv(e,n).forEach(function(a){render(!1,"Chat_Interface_Message",{message:n,session:e},function(e){var t=(t=(t=$("[data-msgts]",a).map(function(){return $(this).attr("data-msgts")>n.msgTS?$(this).attr("data-msgts"):null}).get()).length?Math.min.apply(Math,t):null)?$('[data-msgts="'.concat(t,'"]'),a).first():null;t?e.insertBefore(t):a.append(e),s(e)})})},getMessageDataFromDOM:function(e){var t=e.attr("data-message-hash"),a=e.attr("data-usertypeid"),n=e.attr("data-screenname");return{imgURL:e.attr("data-imgurl"),msgBody:e.find(".chat-message-body").text(),msgHash:t,screenName:n,user:{userTypeID:a}}},fetchPreviousConversation:function(a){var n=Chat7Cups.ChatSessions[a],s=$('[data-chat7cups-chatinterface="'.concat(a,'"]')),o=(s.find('[data-id="load-more-btn"] > button').replaceWith('<div data-id="new-msg-loading" class="text-center mb-4"><i class="fa-solid fa-spin fa-spinner fa-2x"></i></div>'),$('[data-id="container-scrolling"]')),i=o[0].scrollHeight;Chat7Cups.getChatMessages({convID:a,lastMsgTime:n.lastMessage},function(t){if(s.find('[data-id="new-msg-loading"]').first().remove(),t.messages&&t.messages.length){t.messages.reverse();for(var e=0;e<t.messages.length;e++)Chat7CupsUI_Util.LoadChatMessage(n,t.messages[e],function(e){e===t.messages[t.messages.length-1].msgHash&&(e=o[0].scrollHeight-i+o.scrollTop(),o.scrollTop(e))});t.lastMessage&&(Chat7Cups.ChatSessions[a].lastMessage=t.lastMessage),Chat7CupsUI_Util.showLoadMore(a)}})},showLoadMore:function(e){$('[data-chat7cups-chatinterface="'.concat(e,'"] [data-id="load-more-btn"] > button')).length||$('[data-chat7cups-chatinterface="'.concat(e,'"] [data-id="container-messages"]')).prepend('<div data-id="load-more-btn" class="text-center mb-4"><button class="btn bg-light shadow-sm">Load previous messages</button></div>')},leaveConversation:function(e,t){!$('[data-chat7cups-chatinterface="'.concat(t,'"]')).not(e).length&&Chat7Cups.ChatSessions[t]&&(Chat7Cups.ChatSessions[t].lastLeft=Date.now())},LoadChatMessage:function(a,e,n){var t,s=_objectSpread({},e),o=$('[data-chat7cups-chatinterface="'.concat(a.convID,'"]')),e=o.find('.chat-message[data-message-hash="'.concat(s.msgHash,'"]')),i=o.find('[name="msgBody"]'),r=o.find('[data-chat7cups-action="sendmessage"]');"number"==typeof s.msgBody&&(s.msgBody=s.msgBody.toString()),s.msgBody=s.msgBody.replace(/\n/g,"<br/>"),s.msgBody=s.msgFormat&&"html"===s.msgFormat||-1!==["n","b"].indexOf(s.userType)?s.msgBody:Chat7CupsUI_Util.encodeMsg(s.msgBody),(s=_objectSpread(_objectSpread({},s),{},{user:_objectSpread(_objectSpread({},s.user||{}),{},{userType:s.userType||(null==(t=s.user)?void 0:t.userType),userTypeID:s.userTypeID||(null==(t=s.user)?void 0:t.userTypeID)})})).msgID&&(!a.oldestMessageMsgTS||s.msgID<a.oldestMessageMsgTS)&&(a.oldestMessageMsgTS=s.msgID),s.msgHash&&0<e.length?e.find(".card .chat-message-body").html(s.msgBody):(s.msgTS=s.msgTS||moment().unix(),s.user.isMod=s.badges&&-1!==s.badges.indexOf("Mod"),s.hasButton=-1!=s.msgBody.indexOf("<button"),s.msgBody&&(s.screenName=s.screenName||"",s.msgHash=Chat7CupsUI_Util.strip_tags(s.msgHash),s.imgURL=null===s.imgURL?null:Chat7CupsUI_Util.strip_tags(s.imgURL),s.imageClass=s.imageClass||"",s.msgTime=moment(1e3*s.msgTS).format("h:mm A"),s.convSide=s.convSide||(a.user.userTypeID==s.userTypeID?"mine":"other"),"b"==a.otherType&&a.stateLocked&&a.activeButton<parseInt(s.msgID)&&Chat7CupsUI_Util.resetState(),a.allowEndPop=!0,Chat7CupsUI_Util.renderChatRow(a,s,function(e){var t;if(n&&n(s.msgHash),"m"==Chat7Cups.config.user.userType&&0<(t=e.find("a").filter(function(){return $(this).attr("href").includes("whereby.com")})).length&&t.attr("data-chat7cups-action","joinvideo"),"b"!=s.userType||s.func||(t=e.find("button").data("func")||e.find("i").data("func"))&&(s.func=t),"b"==s.userType)switch(s.func){case"waitForChoice":case"waitForButton":Chat7CupsUI_Util.handleBotButton(s);break;case"datePicker":a.stateLocked=!0,i.datepicker("destroy"),i.val(""),i.datepicker({startDate:new Date,orientation:"top",immediateUpdates:!0}).on("changeDate",function(e){a.botDatum=e.date.toString().split(" ").slice(0,4).join(" "),i.val(a.botDatum)}),i.focus(),i.on("keyup",function(){return Chat7CupsUI_Util.resetChatBox(a)}),a.stateLocked=!0,a.activeButton=parseInt(s.msgID),a.stateLocked=!0}if(s.fill&&i.val(s.fill),s.funcEmbed&&e.find("button").data("payload",JSON.stringify(s)),s.func)switch(s.func){case"clearButtons":o.find("button[data-func]").each(function(){var e=$(this).closest("div.chat-message");Chat7CupsUI_Util.removeMessage(e.attr("data-message-hash"),a.convID)});break;case"emptyPing":a.botPing=setTimeout(function(){a.otherUser&&"b"==a.otherUser.userType&&(a.allowEmpty=!0,i.val(""),r.trigger("submit"))},1e3*s.funcArg);break;case"updateCSRF":r.find('input[name="csrf"]').val(s.funcProp);break;case"setupSelect":setupSelect(s.funcProp);break;case"gotoURL":setTimeout(function(){window.location=s.funcArg},500);break;case"gotoListenerSignup":setTimeout(function(){window.location="/listener/become-a-volunteer-listener.php"},500);break;case"gotoGrowthPath":setTimeout(function(){window.location="/path/"},500);break;case"gotoCommunities":setTimeout(function(){window.location="/forum/"},500);break;case"gotoChatrooms":setTimeout(function(){window.location="/connect/groupChatrooms.php"},500);break;case"gotoListener":setTimeout(function(){window.location="/connect/"},500);break;case"wellnessTestModal":Chat7CupsUI_Util.wellnessTestModal();break;case"disableChat":Chat7CupsUI_Util.lockState(!0)}Chat7CupsUI_Util.scrollConversation(a),Chat7CupsUI_Util.updateChatroomParticipants(a)})))},lockState:function(e,t){var a=Chat7Cups.ChatSessions[e],e=(a.botDatum=!1,a.selectData=!1,$('[data-chat7cups-chatinterface="'.concat(e,'"]'))),n=e.find("textarea[name=msgBody]"),s=e.find('[data-id="sendButton"]');n.off("keyup"),a.stateLocked=!0,a.lastPlace=n.attr("placeholder")?n.attr("placeholder"):a.lastPlace,n.blur().attr("disabled",!0).attr("placeholder","").val(""),s.fadeTo(0,.5),t&&e.find(".noniMenu").fadeTo(0,.5).off("click")},resetChatBox:function(e){e.botDatum&&$(this).val(e.botDatum)},enforceSelect:function(e){e.selectData||Chat7CupsUI_Util.resetState(e.convID);for(var t=$('[data-chat7cups-chatinterface="'.concat(e.convID,'"]')),a=t.find("textarea[name=msgBody]"),n=t.find('[data-id="sendButton"]'),t=a.val(),s=new RegExp("^"+t.trim()+"$","i"),o=0;o<e.selectData.length;o++)if(s.test(e.selectData[o]))return void n.fadeTo(0,1);n.fadeTo(0,.5)},resetState:function(e,t){var a=Chat7Cups.ChatSessions[e],e=(a.selectData=!1,a.botDatum=!1,$('[data-chat7cups-chatinterface="'.concat(e,'"]'))),n=e.find("textarea[name=msgBody]"),s=e.find('[data-id="sendButton"]');e.find('[data-id="reply-post"]').html(""),n.unbind("keyup",function(){return Chat7CupsUI_Util.resetChatBox(a)}),n.unbind("keyup",function(){return Chat7CupsUI_Util.enforceSelect(a)}),a.stateLocked=!1,a.quotedMessage=null,n.attr("disabled",!1).attr("placeholder",a.lastPlace),t&&n.val(t),s.fadeTo(0,1),a.activeButtonHash&&(Chat7CupsUI_Util.removeMessage(a.activeButtonHash,a.convID),a.activeButtonHash=!1,a.activeButton=!1),a.botUtils&&a.botUtils.closeMenu(),a.botPing&&clearTimeout(a.botPing)},removeMessage:function(e,t){$('[data-chat7cups-chatinterface="'.concat(t,'"] [data-message-hash="').concat(e,'"]')).hide()},handleBotButton:function(t){"waitForChoice"!=t.func||t.doNotLock?Chat7CupsUI_Util.resetState(t.convID):Chat7CupsUI_Util.lockState(t.convID);var a=$('[data-chat7cups-chatinterface="'.concat(t.convID,'"] [data-chat7cups-action="sendmessage"]')),n=$('[data-message-hash="'.concat(t.msgHash,'"] button[data-func]'));$(n).each(function(e){$(n[e]).on("click",function(e){e=$(e.target).html();Chat7CupsUI_Util.removeMessage(t.msgHash,t.convID),Chat7CupsUI_Util.resetState(t.convID,e),a.trigger("submit")})})},showTitleAlert:function(e,t){e=$('[data-chat7cups-chatinterface="'.concat(e.convID,'"]'));"other"==t.convSide&&e.length&&$.titleAlert("*** NEW Message ***",{requireBlur:!0,stopOnFocus:!0,duration:3e4,interval:500})},listTips:function(t){if(t){if("b"==t.otherType)return!1;t.numConvMessages++;var e=t.numConvMessages||0;t.tips&&t.tips.copy?(Chat7Cups.toConsole("Tips shown",e),a(e)):Chat7Cups.getTips({convID:t.convID},function(){a(e)})}function a(e){e=t.chatRoomType?t.numConvMessages-t.init_numConvMessages:e,t.tips=t.tips||{},t.tips.shown=t.tips.shown||[],t.tips.copy&&t.tips.copy[e]&&-1===$.inArray(e,t.tips.shown)&&(t.tips.shown.push(e),Chat7CupsUI_Util.appendToChat(t.convID,'<div class="alert text-muted small mb-2"><i class="fa-solid fa-info-circle"></i> '+t.tips.copy[e]+"</div>"),Chat7CupsUI_Util.scrollConversation(t))}},scrollConversation:function(a){var n=$('[data-chat7cups-chatinterface="'+a.convID+'"] [data-id="container-scrolling"]'),s=n.prop("scrollHeight");n.is(":animated")||a.scrollPause||n.animate({scrollTop:n.prop("scrollHeight")},300,function(e){var t;Chat7CupsUI_Util.handleDateSticking(a),5<$(this)[0].scrollHeight-($(this).scrollTop()+$(this).innerHeight())&&(Chat7CupsUI_Util.scrollConversation(a),t=n.prop("scrollHeight"),setTimeout(function(){s<t&&Chat7CupsUI_Util.scrollConversation(a)},1e3))})},setActiveTab:function(a){Chat7Cups.ChatListFormatted&&["pm","group"].forEach(function(t){Chat7Cups.ChatListFormatted.ChatList[t]&&Chat7Cups.ChatListFormatted.ChatList[t].forEach(function(e){e.convID===a.convID&&$('[data-bs-target="[data-tab=chatlist-'.concat(t,']"]')).trigger("click")})})},hideModals:function(){$(".modal")&&$(".modal").modal("hide")},connectChat:function(e){Chat7CupsUI_Util.hideModals(),bootbox.dialog({message:"<p>A Listener is ready to talk with you!</p>",buttons:{takeAway:{label:"Ok, take me there",className:"btn-primary",callback:function(){window.location.href="/chat/?c="+e}},cancel:{label:"Remind me in 1 minute",className:"btn-primary",callback:function(){setTimeout(function(){Chat7CupsUI_Util.connectChat(e)},6e4)}}},onShow:function(){$(this).find(".modal-footer").addClass("d-flex justify-content-center")}})},requestPersonalChat:function(t){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},e=("undefined"!=typeof ga&&ga("send","event",{eventCategory:"Button",eventAction:"connectNowPersonalButton",eventLabel:window.location.href}),Chat7CupsUI_Util.eventTracker.trackConnectNowPersonalButton({Page:window.location.href}),$.cookie("lwt")||0),n=Math.floor(Date.now()/1e3);"m"==Chat7Cups.config.user.userType&&!t.bypassAd&&e+1209600<n?void 0!==showWellbeingTest&&showWellbeingTest(function(){Chat7CupsUI_Util.requestPersonalChat(t,a)},function(){takeTest(),a()}):Chat7Cups.requestPersonalChat(t,function(e){switch(e.data&&e.data.action&&"joinConversation"===e.data.action&&(window.location.href="/chat?c=".concat(e.data.convID)),e.data&&e.data.action&&"requestingConversation"===e.data.action&&($.cookie("reqConnecting",1,{path:"/",expires:7200}),$.cookie("reqNew","personal",{path:"/"}),Chat7Cups.handleRequestStarted(e.data),Chat7CupsUI_Util.showRequestConnectingModal(e.data)),e.error&&"getofflinemessage"===e.error&&Chat7CupsUI_Util.leaveMessage(e.data.convID),e.error&&"createaccount"===e.error&&MemberAccountModal("Create a Member Account to Start Chatting",function(){Chat7CupsUI_Util.requestPersonalChat(t)}),null==e||null==(e=e.errors)||null==(e=e[0])?void 0:e.id){case"Account_AccountRequired":Chat7CupsUI_Util.createMemberAccount(function(){Chat7CupsUI_Util.requestPersonalChat(t)});break;case"Account_EmailVerificationRequired":Chat7CupsUI_Util.verifyEmail(function(){Chat7CupsUI_Util.requestPersonalChat(t)});break;case"Account_PhoneVerificationRequired":Chat7CupsUI_Util.verifyPhone(function(){Chat7CupsUI_Util.requestPersonalChat(t)});break;case"Chat_Request_RateLimitExceeded":render(!1,"Chat_Interface_Modal_RequestRateLimitExceeded",{},function(e){bootbox.dialog({message:e})})}a()})},showRequestStatusModal:function(e){Chat7CupsUI_Util.hideModals(),bootbox.dialog({title:_("Connecting you with a listener"),message:e,size:"lg"})},showRequestConnectingModal:function(e){function a(){n();var t=0;$("#textSlides > h1").each(function(e){t=4600*e,$(this).delay(t).fadeIn(300).delay(4e3).fadeOut(300)}),t+=4600,setTimeout(function(){a()},t)}function n(){var e=-1,t=0;$("#textSlides > h1").each(function(){$(this).attr("data-slidenumber",t),t++,e=e>$(this).height()?e:$(this).height(),$("#textSlides").height(e)})}render(!1,"Chat_Interface_Modal_RequestingConversation",{slideTexts:["Take a deep breath, we are connecting you with your listener.","Chatting with your listener is simple like messaging with a trusted friend.","Over 1.5 million people have used 7 Cups to share and grow. ","Each week there are over 100,000 positive and supportive conversations.","Here is what people say about 7 Cups.","&ldquo;So Thankful I Found This Site!&rdquo; &mdash; paperdollsmile","&ldquo;Great place to go when you need an ear. Come by and chat with listeners from all over. They&rsquo;re very kind and helpful&rdquo; &mdash;  Kristi Miranda","&ldquo;No words except thank you!&rdquo; &mdash; Fazal Ali","&ldquo;Awesome app The listeners are really God sent angels..helping people in times of trouble&rdquo; - dheepan brunner","&ldquo;This app helps me! Chatting and mindfulness keeps me calm. Love it! - alysonS","&ldquo;Wow! I&rsquo;m so happy I found this. I think everyone should use this app. I always use this when I am having problems. Its more convenient than therapy.&rdquo; - Aziz Muha","&ldquo;People here listened to me without judging and really helped me through my problems&rdquo; &mdash; Hansel Morales","Our listeners come from all walks of life.","70,000 volunteer listeners","150 countries","Support available in over 130 languages.","We are building a community that is free from stigma and stereotypes and rich with love and support. A world where all 7 billion of us can feel like we truly belong.","We believe that each one of us is inherently valuable.","We do not measure people based on where they are from, what they look like, or what position they hold.","We believe that you make sense in the larger story of your life. We understand that life is not simple or easy.","You are not alone.","You can connect with multiple listeners on 7 Cups. You can find listeners that speak your language or share your interests by clicking on Browse Listeners.","You will soon be connecting with your listener.","Think of your listener like a trusted friend.","In the meantime, just breathe.","Breathing can transform your life.","If you feel stressed out and overwhelmed, breathe.","It will calm you and release the tensions.","If you are worried about something coming up, breathe.","It will bring you back to the present.","If you are discouraged and have forgotten your purpose in life, breathe.","It will remind you of how precious life is.","That each breath in this life is a gift you need to appreciate.","Make the most of this gift.","If you have too many tasks to do, breathe.","It will help bring you into focus.","Help you concentrate on the most important task.","If you are spending time with someone you love, breathe.","It will allow you to be present with that person.","Rather than thinking about work or other things you need to do.","If you are moving too fast, breathe.","It will remind you to slow down, and enjoy life more.","Just breathe, we are here for you.","We are glad you joined us.","Just being here shows us that you want the world to be a better place. That is how we feel too.","Continue to just breathe. We are finding you a listener.","7 Cups is a home for all people. Everyone belongs here and you do too.","Each small step on 7 Cups is a step in the right direction.","We are all on the same path. Some of us are just starting out. Others are further down the road. No matter where we are, being kind, compassionate, and accepting of one another enables us all to grow."]},function(e){Chat7CupsUI_Util.hideModals(),bootbox.dialog({title:_("Connecting you with a listener"),message:e,size:"lg"})});$(window).on("resize",function(){n()}),a()},leaveMessage:function(o){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var a,n,s;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:$("#noReqest > h1").html("What would you like to do now?"),$(".connectingContent").hide(),$("#noReqest").show(),Chat7CupsUI_Util.hideModals(),a=$('<div class="messWaiting text-center"><i class="fa-solid fa-spinner fa-spin fa-2x"></i></div>'),n=$("<span></span>"),s=bootbox.dialog({title:n,message:a,closeButton:!0,onEscape:!1}),Chat7Cups.callAPI("GET","/chat/conversation/".concat(o,"/request"),{},function(e){var t="Leave an Offline Message";e.otherScreenName&&(t+=" for ".concat(e.otherScreenName)),render(!1,"Chat_Modal_LeaveMessage",{convID:o,apiEndpoint:"".concat(Chat7Cups.config.apiPath,"/chat/conversation")},function(e){n.html(t),a.html(e),e.find("form").on("apiSuccess",function(){s.modal("hide"),render(!1,"Chat_Modal_LeaveMessageSent",{},function(e){bootbox.dialog({title:_("Your message has been sent"),message:e})})})})});case 8:case"end":return e.stop()}},e)}))()},giveOpts:function(t){Chat7CupsUI_Util.hideModals(),render(!1,"Chat_Modal_RequestGiveOptions",{},function(e){bootbox.dialog({message:e}),e.find('[data-request-action="leaveMessage"]').on("click",function(){return Chat7CupsUI_Util.leaveMessage(t)}),e.find('[data-request-action="giveOptions"]').on("click",function(){setTimeout(function(){Chat7CupsUI_Util.giveOpts(t)},Chat7Cups.config.askOptsDelayMS)})})},handleDateSticking:function(a){var n=1;$('[data-chat7cups-chatinterface="'+a.convID+'"] [data-id="container-scrolling"]').on("scroll",function(e){clearTimeout(n);var t=$('[data-chat7cups-chatinterface="'.concat(a.convID,'"] [data-id="divider"]'));t.each(function(e){$(this).css({opacity:"1"})}),n=setTimeout(function(){t.each(function(){$(this).css({opacity:"0"})})},2e3)})},showSharingCircleModal:function(e,t){!$.cookie("seenSCModal")&&e.sharingCircleRooms.includes(t)&&["m"].includes(Chat7Cups.config.user.userType)&&($.cookie("seenSCModal",!0,{expires:30,path:"/"}),render(!1,"Chat_Modal_SharingCircleIntro",{},function(e){bootbox.dialog({title:'<h3 class="modal-title"><strong>Welcome to the Sharing Circle!</strong> We are glad you are here!</h3>',message:e,size:"lg",buttons:{cancel:{label:"Cancel",className:"btn btn-link text-muted",callback:function(){window.location.href="/dashboard"}},confirm:{label:"I understand",className:"ms-auto btn btn-success"}}})}))},loadRatingModal:function(t){t&&render(!1,"Chat_Interface_Modal_RateListener",{session:t,apiEndpoint:"".concat(Chat7Cups.config.apiPath,"/chat/conversation/").concat(t.convID,"/rate")},function(e){var a,n=bootbox.dialog({title:"Review Listener",message:e});Chat7CupsUI_Util.eventTracker.trackerRatingModalShown(),n.find("form").on("submit",function(e,t){a=$(this).find('[name="overallRating"]').val()}),n.find("form").on("apiSuccess",function(){n.modal("hide"),Chat7CupsUI_Util.eventTracker.trackListenerRating({rating:a}),$('[data-chat7cups-chatinterface="'.concat(t.convID,'"] [data-chat7cups-action="ratelistener"]')).addClass("d-none")}).on("apiError",function(e,t){Array.isArray(t)&&t[0]&&n.find(".alert-resp").html(t[0])})})},updateChatroomParticipants:function(e){e.inChatroom=e.inChatroom||[],e.inChatroom.sort(function(e,t){return e.screenName.toString().toLowerCase()===t.screenName.toString().toLowerCase()?0:e.screenName.toString().toLowerCase()>t.screenName.toString().toLowerCase()?1:-1}),e.activeParticipantCount=e.inChatroom.length,e.activeParticipantCount&&($('[data-chat7cups-chatlink="'+e.convID+'"] [data-id="lastmessagetime"]').addClass("d-none"),$('[data-chat7cups-chatlink="'+e.convID+'"] [data-id="live-status"]').removeClass("d-none"),$('.nav-tabs [data-chat-count="live"]').removeClass("d-none").text(e.activeParticipantCount)),$('[data-chat7cups-chatinterface="'+e.convID+'"] [data-id="participantscount"]').text(e.activeParticipantCount),$('[data-chat7cups-chatlink="'+e.convID+'"] [data-id="participantscount"]').text(e.activeParticipantCount),$('[data-chat7cups-sidebar="'.concat(e.convID,'"] [data-id="participantscount"]')).text(e.activeParticipantCount),$('[data-chat7cups-sidebar="'.concat(e.convID,'"] [data-id="live-status"]')).toggleClass("d-none",!e.activeParticipantCount)},wellnessTestModal:function(){var e=$("<div></div>");e.setWellnessEngineTestInterface("EmotionalWellness"),bootbox.dialog({closeButton:!0,onEscape:!1,message:e,size:"large"})},verifyPhone:function(a){a="function"==typeof a?a:function(){};$.getScript(PATH_CLOUDFRONT+"dist/js/User/Account/PhoneVerifier.js?v_"+(window.CLOUDFRONT_VERSION_JS||""),function(){(new window.SC_User_Account_PhoneVerifier).verifyPhone(function(e,t){e.closest(".modal").modal("hide"),a()})})},verifyEmail:function(a){a="function"==typeof a?a:function(){};$.getScript(PATH_CLOUDFRONT+"dist/js/User/Account/EmailVerifier.js?v_"+(window.CLOUDFRONT_VERSION_JS||""),function(){(new window.SC_User_Account_EmailVerifier).verifyEmail(function(e,t){e.closest(".modal").modal("hide"),a()})})},createMemberAccount:function(a){a="function"==typeof a?a:function(){};$.getScript(PATH_CLOUDFRONT+"dist/js/User/Account/CreateMember.js?v_"+(window.CLOUDFRONT_VERSION_JS||""),function(){(new window.SC_User_Account_CreateMember).renderCreateAccountForm(function(e,t){e.closest(".modal").modal("hide"),Chat7Cups.getChatList(),a()})})},eventTracker:{trackQuoteReply:function(e){var t=Chat7Cups.ChatSessions[e];tracker.emit("quoteReplySend",{convID:e,chatRoomType:t.chatRoomType})},trackStartVideoClick:function(e){tracker.emit("Telehealth",{action:"Start session",convID:e})},trackJoinVideoSessionClick:function(e){tracker.emit("Telehealth",{action:"Join session",convID:e})},trackStartGameClick:function(e){tracker.emit("Games",{action:"Start game",convID:e})},trackJoinGameClick:function(e){tracker.emit("Games",{action:"Join game",convID:e})},trackGeneralRequestViewed:function(){var e=Chat7Cups.RequestQue.que.general.length;tracker.emit("generalRequestViewed",{reqCount:e,generalRequestViewerStatus:null==(e=Chat7Cups.config.user)?void 0:e.onlineStatus,waitTime:(Chat7Cups.RequestQue.avgWait||0)/60})},trackJITTEvent:function(e){tracker.emit("NoniJITT",{action:e.action})},trackGeneralRequestTaken:function(e){var t,a;e&&(t=Math.floor(Date.now()/1e3)-e.reqTimeTS,a=Chat7Cups.RequestQue.que[e.reqType].length,tracker.emit("generalRequestTaken",{teen:"teen"===e.reqAge,convID:e.convID,reqCount:a,onlineStatus:Chat7Cups.config.user.onlineStatus,waitTime:(Chat7Cups.RequestQue.avgWait||0)/60,actualWait:t/60}))},trackPersonalRequestAction:function(e,t){var a={action:e,reqCount:Chat7Cups.RequestQue.que[t.reqType].length};"accept"!==e&&"decline"!==e||(a.requestingMemberScreenName=t.userScreenName,a.requestingMemberStatus=t.otherOnline,a.convID=t.convID,a.actualWait=((new Date).getTime()/1e3-t.reqTimeTS)/60),tracker.emit("personalRequestAction",a)},trackerRatingModalShown:function(){tracker.emit("RatingModalShown")},trackListenerRating:function(e){tracker.emit("ListenerRating",e)},trackConnectNowPersonalButton:function(e){tracker.emit("connectNowPersonalButton",e)},trackAdviceAndCris:function(e){tracker.emit("AdviceAndCrisis",e)},trackClickChatHelpButton:function(){tracker.emit("ClickChatHelpButton")},trackNoniMessage:function(e){tracker.emit("noniMessage",{msg:e})},trackBotMessage:function(e){tracker.emit("botMessage",_objectSpread({bot:Chat7Cups.currentNoni.screenName},e))},trackOnlineTherapy:function(e){tracker.emit("OnlineTherapy",_objectSpread({reqType:"general_therapy"},e))}}};function showWellbeingTest(t,a){var e=Math.floor(Date.now()/1e3);$.cookie("lwt",e,{path:"/",expires:1}),render(!1,"SC_Ads_WantToBetterUnderstandYourself",{},function(e){bootbox.dialog({message:e,onEscape:!1,backdrop:!0,closeButton:!1,onShow:function(){var e=$(this);e.find(".btn-primary:first").trigger("focusout"),e.find('button[data-action="cancel"]').on("click",function(){e.modal("hide"),t&&t()}),e.find('button[data-action="taketest"]').on("click",function(){e.modal("hide"),a&&a()})}})})}function takeTest(){render(!1,"SC_WellnessEngine_Test",null,function(e){$modal=bootbox.dialog({message:'<div class="text-center" id="TestHolder"><i class="fa-solid fa-spin fa-spinner"></i> Loading Wellness Test</div>',size:"large",onEscape:function(){$.get("/connect/holdRequest.php",{holdReq:0})},onShow:function(){$("#TestHolder").setWellnessEngineTestInterface("EmotionalWellness");var e=document.createElement("style");e.type="text/css",e.innerHTML=".progress-bar { height: 1rem; color: #fff; background-color: #0275d8; height: 2rem;}",e.innerHTML+=".progress { background-color: #eceeef; border-radius: .75rem; overflow: hidden; line-height: 1rem;}",document.body.appendChild(e)}})})}function listenerRecommendRequestPM(e,t,a,n,s){return tracker.emit("SuggestedListener",{action:"chatnow",location:"newmembermodal",numConversations:a,numHelped:n,overallRating:s}),Chat7CupsUI_Util.requestPersonalChat({userID:t,userType:e})}function startConnection(){$(".modal")&&$(".modal").modal("hide");var a,n=null;function c(e,t,a){a="function"==typeof a?a:function(){},n?(n.find(".bootbox-body").html(e),a()):n=bootbox.dialog({message:e}).off("shown.bs.modal").on("shown.bs.modal",a),"undefined"!=typeof ga&&ga("send","event",{eventCategory:"ConnectNowModal",eventAction:t}),tracker.emit("ConnectNowModal",{Slide:t})}function s(){function t(e){e<18?o():render(!1,"SC_Chat_SelectChatType",{PATH_S3:PATH_S3,PATH_CLOUDFRONT:PATH_CLOUDFRONT,issue:window.userInfo&&window.userInfo.focus&&window.userInfo.focus.title?window.userInfo.focus.title:null},function(e){c(e,"SelectChatType",function(){n.find("[data-action-select]").on("click",function(){n.find("[data-action-select]").addClass("disabled"),"therapist"===$(this).attr("data-action-select")?tracker.emit("ctaTherapy",{location:"chatSelection",uri:window.location.href},function(){window.location.href="/online-therapy/signup/"}):("undefined"!=typeof ChatSession&&ChatSession.otherUser&&"b"==ChatSession.otherUser.userType&&currentNoni.screenName?(bootbox.hideAll(),resetState("Please connect me with someone to talk to"),sendMessage):o)()})})})}window.userInfo.age?t(window.userInfo.age):render(!1,"SC_Chat_SelectAge",{allowTeen:!0,allowAdult:!0,allowTeenAndAdult:!0},function(e){c(e,"#connectNowAgree",function(){n.find("[data-action-age]").on("click",function(){return window.userInfo.age="teen"===$(this).attr("data-action-age")?17:18,t(window.userInfo.age),!1})})})}function o(){e(function(e){render(!1,"SC_Chat_SelectIssue",{reqAge:18<=(window.userInfo.age||18)?"adult":"teen",issues:e},function(e){c(e,"SelectIssue"),e.on("submit",'form[action="/connect/"]',function(e){e.preventDefault(),function i(r){$.post("/apiv2/chat/conversation",r,function(e){return e.error?c('<h3 class="my-3 text-danger">'+e.error+"</h3>","SelectIssue"):e.data?($.cookie("reqConnecting",1,{path:"/",expires:7200}),$.cookie("reqNew","general",{path:"/"}),Chat7Cups&&Chat7Cups.handleRequestStarted(e.data),c('<div class="mt-4 text-center"><div><i class="fa-solid fa-spin fa-spinner fa-3x"></i></div><h3 class="my-3">'+_("You are being connected to a listener. Feel free to explore 7 Cups while you wait. Well let you know as soon as your listener is ready.")+'</h3><div><a href="/dashboard/" class="btn btn-success btn-lg">'+_("Okay")+"</a></div></div>","Connecting")):void 0},"json").fail(function(e,t,a){var n,e=null!=(e=e.responseJSON)?e:{};switch(null==e||null==(n=e.errors)||null==(n=n[0])?void 0:n.id){case"Account_AccountRequired":var s=$('<div><div class="text-center"><i class="fa fa-spin fa-spinner fa-2x"></i></div></div>'),o=$('<div class="text-center"><h5>'+_("Email Verification is Required")+"</h5></div>").append(s);return $.getScript(PATH_CLOUDFRONT+"dist/js/User/Account/CreateMember.js?v_"+(window.CLOUDFRONT_VERSION_JS||""),function(){var e=new window.SC_User_Account_CreateMember;e.renderCreateAccountForm(function(e,t){i(r)})}),c(o);case"Account_EmailVerificationRequired":s=$('<div><div class="text-center"><i class="fa fa-spin fa-spinner fa-2x"></i></div></div>'),o=$('<div class="text-center"><h5>'+_("Email Verification is Required")+"</h5></div>").append(s);return $.getScript(PATH_CLOUDFRONT+"dist/js/User/Account/EmailVerifier.js?v_"+(window.CLOUDFRONT_VERSION_JS||""),function(){var e=new window.SC_User_Account_EmailVerifier;e.verifyEmail(function(e,t){i(r)})}),c(o);case"Account_PhoneVerificationRequired":s=$('<div><div class="text-center"><i class="fa fa-spin fa-spinner fa-2x"></i></div></div>'),o=$('<div class="text-center"><h5>'+_("Phone Verification is Required")+"</h5></div>").append(s);return $.getScript(PATH_CLOUDFRONT+"dist/js/User/Account/PhoneVerifier.js?v_"+(window.CLOUDFRONT_VERSION_JS||""),function(){var e=new window.SC_User_Account_PhoneVerifier(s);e.verifyPhone(function(){i(r)})}),c(o);case"Chat_Request_RateLimitExceeded":o=$("<div></div>");return render(!1,"Chat_Interface_Modal_RequestRateLimitExceeded",{},function(e){o.append(e)}),c(o)}c('<h3 class="my-3 text-danger">'+(null!=(n=e.error)?n:a)+"</h3>","SelectIssue")});c('<div class="mt-4 text-center"><div><i class="fa-solid fa-spin fa-spinner fa-3x"></i></div><h3 class="my-3">'+_("Searching available listeners...")+"</h3></div>","Connecting")}($(this).serialize())})})})}function e(t){if(a)return"LOADING"===a?void setTimeout(function(){e(t)},1e3):void("function"==typeof t&&t(a));a="LOADING",$.getJSON("/ajax/issueArray.php",function(e){(a=Object.values(e)).sort(function(e,t){return e.catName>t.catName?1:-1}),"function"==typeof t&&t(a)})}"l"==window.userInfo.userType?render(!1,"SC_Chat_NoListenerRequests",{},function(e){c(e,"ListenersNotAllowed")}):"g"==window.userInfo.userType?MemberAccountModal("Create a member account to proceed.",function(e){if(e.user)for(var t in e.user)window.userInfo[t]=e.user[t];s()}):s(),e()}function MemberAccountModal(e,t){var a;window.userInfo&&"m"===window.userInfo.userType?bootbox.alert('<h2 class="text-center text-info my-4">You are Already Signed in as a Member</h2>'):MemberAccountForm(e,function(e){a=bootbox.dialog({message:e,closeButton:!0,onEscape:!1,size:"large"})},function(e){a.modal("hide"),"function"==typeof t?t(e):location.reload()})}function MemberAccountForm(e,t,s){tracker.emit("memberAccountForm",{uri:window.location.href});e={screenName:window.userInfo&&window.userInfo.screenName&&"g"===window.userInfo.userType?window.userInfo.screenName:null,optReason:e,fwd:window.location.href,opts:{dobYear:(()=>{for(var e=[],t=(new Date).getFullYear(),a=t-10;t-110<=a;a--)e.push(a);return e})()}};render(!1,"Forms/Account/CreateMemberAccount",e,function(e){var e=$(e),n=$('form[action="/apiv2/user"]',e);$('[name="createacct_orgCode"]',n).on("click",function(){$(this).closest("label").hide(),$(this).is(":checked")?$(this).closest(".mb-3").find('[data-id="holder-orgCode"]').show():$(this).closest(".mb-3").find('[data-id="holder-orgCode"]').hide()}),$('[name="dobMonth"], [name="dobDay"], [name="dobYear"]',n).on("change",function(){var e=$('[name="dobMonth"]',n).val(),t=$('[name="dobDay"]',n).val(),a=$('[name="dobYear"]',n).val();e&&t&&a&&(a=new Date(a,e,t),moment().diff(a,"years")<18?$('[data-id="terms-teen"]',n).show():$('[data-id="terms-teen"]',n).hide())}),n.on("apiSuccess",function(e,t,a){"undefined"!=typeof ga&&ga("send","event",{eventCategory:"CreateMemberAccount"}),tracker.emit("Created member account",{uri:window.location.href}),"function"==typeof s?s(t):window.location.href="/dashboard/"}),"function"==typeof t&&t(e)})}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,a){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0===a)return("string"===t?String:Number)(e);a=a.call(e,t||"default");if("object"!=_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}$(function(){$("body").on("click","[data-request]",function(){var t,e=$(this);(listID=e.attr("data-listid"))?"offlinesession"===e.attr("data-request")&&(t=listID,render(!1,"SC_Forms_Connect_TherapistOfflineSessionWarning",{},function(e){bootbox.dialog({title:"Request In-Person Therapy",message:e,onEscape:!0,backdrop:!0,closeButton:!0,buttons:{cancel:{label:"Cancel",className:"btn-link text-muted"},agree:{label:"I Agree",className:"btn-success",callback:function(){render(!1,"SC_Forms_Connect_TherapistOfflineSession",{userInfo:window.userInfo,listID:t},function(e){bootbox.dialog({title:"Request In-Person Therapy",message:e,onEscape:!0,backdrop:!0,closeButton:!0,buttons:{cancel:{label:"Cancel",className:"btn-link text-muted"},submit:{label:"Send Request",className:"btn-success",callback:function(){var e,t=0;return($bbmodal=$(this)).find("form .alert-danger").remove(),$bbmodal.find(".is-invalid").removeClass("is-invalid"),$bbmodal.find("[data-required]").each(function(){$(this).val()||($(this).addClass("is-invalid"),t++)}),t<=0&&(e=$bbmodal.find('button[data-bb-handler="submit"]').html(),$bbmodal.find('button[data-bb-handler="submit"]').addClass("disabled").html('Processing <i class="fa-solid fa-spinner fa-spin"></i>'),$.post($bbmodal.find("form").attr("action"),$bbmodal.find("form").serialize(),function(e){if(e.success)$bbmodal.modal("hide"),bootbox.alert('<h1 class="text-center">Thank You</h1><h3 class="text-center">Your request has been sent. Your therapist will respond shortly.</h3>');else if(e.err)for(var t in e.err)"copy"==t&&$bbmodal.find("form").prepend('<div class="alert alert-danger">'+e.err.copy+"</div>"),$bbmodal.find('[name="'+t+'"]').length&&$bbmodal.find('[name="'+t+'"]').addClass("is-invalid").after('<p class="text-help">'+e.err[t]+"</p>")},"json").always(function(){$bbmodal.find('button[data-bb-handler="submit"]').removeClass("disabled").html(e),$bbmodal.find('form [name="vscu"]').val(""),$bbmodal.find("form .captchaParent").load("/objects/captcha/renderCaptcha.php")})),!1}}}}).on("shown.bs.modal",function(){$("body").addClass("modal-open"),$(this).find('[name="requestorName"]').focus(),$(this).find("form .captchaParent").load("/objects/captcha/renderCaptcha.php")})})}}}})})):bootbox.alert("Unable to identify requested user.")}),$("body").on("click",'a[href="/connect/"]',function(e){var t;"g"!==((null==(t=window)||null==(t=t.userInfo)?void 0:t.userType)||"g")&&(e.preventDefault(),startConnection())})}),$(function(){$("body").on("click",'[data-modal-target="NewMemberAccount"]',function(e){$(this).removeAttr("href"),e.preventDefault(),MemberAccountModal($(this).attr("data-optreason")||null)})});var EmojiPicker=(()=>_createClass(function e(t){if(_classCallCheck(this,e),_defineProperty(this,"onSelectEmoji",void 0),!t)throw Error("Missing param onSelectEmoji");this.onSelectEmoji=t},[{key:"selectEmoji",value:function(e){this.onSelectEmoji(e)}},{key:"renderPicker",value:function(){var a=this;render(!1,"Element_EmojiPicker",{},function(e){bootbox.dialog({title:_("Select Emoji"),message:e,onEscape:!0,backdrop:!0,closeButton:!0,onShow:function(){var t=$(this);t.on("click",".sc-emoji-picker-emoji",function(){var e=$(this).text();a.selectEmoji(e),t.modal("hide")}).on("input",".sc-emoji-picker-input",function(){var e=this.value;""!=e?$(this).closest(".sc-emoji-picker").find(".sc-emoji-picker-emoji:not([title*='"+e+"'])").hide():$(this).closest(".sc-emoji-picker").find(".sc-emoji-picker-emoji").show()}).on("click",".nav-link",function(){$(this).closest(".nav").find(".nav-link.active").removeClass("active"),$(this).addClass("active")})}})})}}]))();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function reveal(){for(var e=document.querySelectorAll(".reveal-slideup:not(.reveal-state-done), .reveal-fadein:not(.reveal-state-done)"),t=0;t<e.length;t++){var a=e[t],n=window.innerHeight;a.getBoundingClientRect().top<n-150?(a.classList.remove("reveal-state-ready"),a.classList.add("reveal-state-done")):a.classList.add("reveal-state-ready")}}$(function(){$("body").on("click",'a[target="_blank"][href]',function(){var t,e=this.href;t=e,[new RegExp("^/"),new RegExp("^(mailto:|tel:|javascript:|#)"),new RegExp("^"+window.location.origin.replace(/[.*+?^${}()|[\]\\\/]/g,"\\$&"))].some(function(e){return e.test(t)})||tracker.emitThenFollow("externalLink",{uri:window.location.href,link:e})})}),window.HandleBarsHelpersLoaded||(window.windowHandleBarsHelpersLoaded=!0,Handlebars.registerHelper({eq:function(e,t){return e===t},neq:function(e,t){return e!==t},lt:function(e,t){return e<t},gt:function(e,t){return t<e},lte:function(e,t){return e<=t},gte:function(e,t){return t<=e},and:function(){return Array.prototype.slice.call(arguments,0,arguments.length-1).every(Boolean)},or:function(){return Array.prototype.slice.call(arguments,0,arguments.length-1).some(Boolean)},_:(t=>{function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e})(function(e){return"undefined"!=typeof _?_(e):e}),addCommas:function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},jsonEncode:function(e){return JSON.stringify(e)},arrlength:function(e){return Array.isArray(e)?e.length:0},inarr:function(e,t){return t=(t="string"==typeof t?JSON.parse(t):t).map(function(e){return e.toString()}),e=e.toString(),t.includes(e)},GlobalVar:function(e){return{PATH_CLOUDFRONT:PATH_CLOUDFRONT||"",PATH_S3:PATH_S3||""}[e]||""},modzero:function(e,t){return(e+1)%t==0},plusone:function(e){return e+1},tostring:function(e){return"object"===_typeof(e)?JSON.stringify(e):e}})),window.registerHandlebarsPartial=function(t,a){var e=["desktop","base",{reactions_comments:"Reaction/Comment",exercise_item:"Path/Exercise/Item",exercise_item_accordion:"Path/Exercise/AccordionItem"}[t]||t.split("_").join("/")];$.get("/templates/"+e.join("/")+".html?v="+(window.HANDLEBARS_TEMPLATE_VERSION||""),function(e){Handlebars.registerPartial(t,e),a()})},window.hb_templates={},window.render=function(e,t,a,n,s){var o,i="desktop",r="base",l=(void 0===o&&(o="/templates/"),t.split("_")),u=!1;if("SC"==l[0]&&l.shift(),s){for(var c in u=[],l)u.push(l[c]);u.unshift(r),u.unshift(i),u=u.join("/")}l.unshift(r),l.unshift(i);l=l.join("/");hb_templates[t]=hb_templates[t]||new function(t){var r=[],c=!1;return $.ajax({url:o+(u||l)+".html?v="+(window.HANDLEBARS_TEMPLATE_VERSION||""),success:function(e){for(c=Handlebars.compile(e);r.length;)hb_templates[t].apply(null,r.shift())},error:function(e){console.log("Cannot Resolve Template:",l)}}),function(t,a,n,s,o){if(c)try{var e=$(c(n));t&&t.prepend(e),s&&s(e),"undefined"!=typeof grecaptcha&&$(".g-recaptcha",e).length&&grecaptcha.ready(function(){$(".g-recaptcha",e).each(function(){grecaptcha.render(this,{sitekey:window.GOOGLE_RECAPTCHA_PUBLIC})})})}catch(e){var i;/The partial ([^\ ]+) could not be found/.test(e.message)?(i=/The partial ([^\ ]+) could not be found/.exec(e.message),registerHandlebarsPartial(i[1],function(){render(t,a,n,s,o)})):console.log("Handlebars Error:",e)}else r.push(arguments)}}(t),hb_templates[t].apply(null,arguments)},$(function(){$('input[data-clipboard="target"]').on("click",function(){if($(this).trigger("focus"),$(this)[0].setSelectionRange(0,$(this).val().length),"execCommand"in document)try{document.execCommand("copy")&&bootbox.alert("Referral Link Copied to Clipboard!")}catch(e){}}),$("[data-clipboard-trigger]").on("click",function(){$($(this).attr("data-clipboard-trigger")).trigger("click")})}),$(function(){$("[data-lazy-bg-image]").each(function(){var e=$(this).attr("data-lazy-bg-image");$(this).css("background-image",e)})}),window.updateLocale=function(e){$.post("/api/utility/locale/update/",{reqLang:e},function(){window.location.href=window.location.href.split("?").map(function(e,t){return t?e.split("&").filter(function(e){return!e.startsWith("locale=")}).join("&"):e}).join("?")})},window.addEventListener("scroll",reveal),window.WellnessEngineTest=function(e,t,a){function n(e,t,a,n){(a=a||{}).administration=s.administration,a.resourceIdent=s.resourceIdent,a.sessionID=s.sessionID,$.ajax({url:s.apiEndpoint+e,method:t.toUpperCase(),data:a,dataType:"json",xhrFields:{withCredentials:!0},success:function(e){!s.sessionID&&e.session&&e.session.id&&(s.sessionID=e.session.id),"function"==typeof n&&n(e)},error:function(e,t,a){alert("API Error: ["+t+" "+e.status+" - "+a+"] "+(e&&e.responseJSON&&e.responseJSON.error?e.responseJSON.error:""))}})}var s={apiEndpoint:(!0===window.isApp?"":"/")+"apiv2/wellnessengine/",administration:e,resourceIdent:a,sessionID:t};this.init=function(e){return n("test","GET",{},e),this},this.submit=function(e,t){return n("test/answer","POST",e,t),this}},$(function(){$.fn.setWellnessEngineTestInterface=function(e,t,a){function o(e){e.params=a,console.log("RENDERING",a),render(!1,i,e,function(e){n.html(e)}),n.trigger("apiResponse",[e])}var n=$(this),e=e||n.attr("data-administration")||n.attr("data-test-administration"),t=t||n.attr("data-session"),s=n.attr("data-resource"),i=(!0===window.isApp?"SC_":"")+"WellnessEngine_Test",r=(console.log("in init",a),n.find("form").length||o({}),new WellnessEngineTest(e,t,s).init(o));n.on("click",'form [type="submit"]',function(e){e.preventDefault();for(var e=$(this),t=e.closest("form"),a=(t.find('[type="submit"]').attr("disabled","true"),e.html('<i class="fa-solid fa-spin fa-spinner"></i> Saving'),{}),n=t.serializeArray(),s=0;s<n.length;s++)a["answerValue"===n[s].name?"answer":n[s].name]=n[s].value;e.attr("name")&&(a["answerValue"===e.attr("name")?"answer":e.attr("name")]=e.val()),r.submit(a,o)})}});